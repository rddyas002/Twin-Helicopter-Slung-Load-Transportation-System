<pre class="code">
<span class="srcline"><span class="lineno"><a href="77,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T46U3">x_est</span>,<span class="var type1" id="S3T1U4">resnorm</span>] = solvePoseEst(<span class="var type1" id="S4T46U7">x</span>,<span class="var type1" id="S5T2U8">z</span>,<span class="var type1" id="S6T5U9">object_points</span>)    </span></span>
<span class="srcline"><span class="lineno"><a href="77,2" id="srcline2">  2</a></span><span class="line">    <span class="mxinfo" id="T1:U6"><span class="var type1" id="S7T1U12">num_measurements</span> = <span class="mxinfo" id="T1:U8">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,3" id="srcline3">  3</a></span><span class="line">    <span class="comment">% only allow single blob detection for now</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,4" id="srcline4">  4</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S8T1U16">i</span> = <span class="mxinfo" id="T1:U10">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="77,5" id="srcline5">  5</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T8:U11"><span class="mxinfo" id="T1:U12"><span class="mxinfo" id="T53:U13"><span class="var type1" id="S5T2U26">z</span>(<span class="var type1" id="S8T1U27">i</span>)</span>.number_red</span> == <span class="mxinfo" id="T1:U16">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="77,6" id="srcline6">  6</a></span><span class="line">            <span class="mxinfo" id="T1:U17"><span class="var type1" id="S7T1U32">num_measurements</span> = <span class="mxinfo" id="T1:U19"><span class="var type1" id="S7T1U34">num_measurements</span> + <span class="mxinfo" id="T1:U21">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,7" id="srcline7">  7</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,8" id="srcline8">  8</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T8:U22"><span class="mxinfo" id="T1:U23"><span class="mxinfo" id="T53:U24"><span class="var type1" id="S5T2U42">z</span>(<span class="var type1" id="S8T1U43">i</span>)</span>.number_green</span> == <span class="mxinfo" id="T1:U27">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="77,9" id="srcline9">  9</a></span><span class="line">            <span class="mxinfo" id="T1:U28"><span class="var type1" id="S7T1U48">num_measurements</span> = <span class="mxinfo" id="T1:U30"><span class="var type1" id="S7T1U50">num_measurements</span> + <span class="mxinfo" id="T1:U32">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,10" id="srcline10"> 10</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,11" id="srcline11"> 11</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T8:U33"><span class="mxinfo" id="T1:U34"><span class="mxinfo" id="T53:U35"><span class="var type1" id="S5T2U58">z</span>(<span class="var type1" id="S8T1U59">i</span>)</span>.number_blue</span> == <span class="mxinfo" id="T1:U38">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="77,12" id="srcline12"> 12</a></span><span class="line">            <span class="mxinfo" id="T1:U39"><span class="var type1" id="S7T1U64">num_measurements</span> = <span class="mxinfo" id="T1:U41"><span class="var type1" id="S7T1U66">num_measurements</span> + <span class="mxinfo" id="T1:U43">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,13" id="srcline13"> 13</a></span><span class="line">        <span class="keyword">end</span>        </span></span>
<span class="srcline"><span class="lineno"><a href="77,14" id="srcline14"> 14</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,15" id="srcline15"> 15</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="77,16" id="srcline16"> 16</a></span><span class="line">    <span class="mxinfo" id="T48:U44"><span class="var type1" id="S9T48U70">A_lin</span> = <span class="mxinfo" id="T48:U46">zeros(<span class="var type1" id="S7T1U73">num_measurements</span>,<span class="mxinfo" id="T1:U48">7</span>)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="77,17" id="srcline17"> 17</a></span><span class="line">    <span class="mxinfo" id="T34:U49"><span class="var type1" id="S11T34U77">b_lin</span> = <span class="mxinfo" id="T34:U51">zeros(<span class="var type1" id="S7T1U80">num_measurements</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,18" id="srcline18"> 18</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="77,19" id="srcline19"> 19</a></span><span class="line">    <span class="mxinfo" id="T34:U53"><span class="var type1" id="S12T34U84">z_est</span> = <span class="mxinfo" id="T34:U55">zeros(<span class="var type1" id="S7T1U87">num_measurements</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,20" id="srcline20"> 20</a></span><span class="line">    <span class="mxinfo" id="T34:U57"><span class="var type1" id="S13T34U91">z_meas</span> = <span class="mxinfo" id="T34:U59">zeros(<span class="var type1" id="S7T1U94">num_measurements</span>,1)</span></span>;    </span></span>
<span class="srcline"><span class="lineno"><a href="77,21" id="srcline21"> 21</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="77,22" id="srcline22"> 22</a></span><span class="line">    <span class="mxinfo" id="T6:U61"><span class="var type1" id="S14T6U98">Twp</span> = <span class="mxinfo" id="T6:U63"><span class="var type1" id="S4T46U100">x</span>(<span class="mxinfo" id="T17:U65"><span class="mxinfo" id="T1:U66">1</span>:<span class="mxinfo" id="T1:U67">3</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,23" id="srcline23"> 23</a></span><span class="line">    <span class="mxinfo" id="T9:U68"><span class="var type1" id="S15T9U106">qwp</span> = <span class="mxinfo" id="T9:U70"><span class="var type1" id="S4T46U108">x</span>(<span class="mxinfo" id="T18:U72"><span class="mxinfo" id="T1:U73">4</span>:<span class="mxinfo" id="T1:U74">7</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,24" id="srcline24"> 24</a></span><span class="line">    <span class="mxinfo" id="T1:U75"><span class="var type1" id="S16T1U114">k</span> = <span class="mxinfo" id="T1:U77">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,25" id="srcline25"> 25</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S8T1U118">i</span> = <span class="mxinfo" id="T1:U79">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="77,26" id="srcline26"> 26</a></span><span class="line">        <span class="mxinfo" id="T5:U80"><span class="var type1" id="S17T5U124">A</span> = <span class="mxinfo" id="T5:U82"><span class="mxinfo" id="T5:U83"><span class="mxinfo" id="T4:U84"><span class="mxinfo" id="T53:U85"><span class="var type1" id="S5T2U129">z</span>(<span class="mxinfo" id="T1:U87">1</span>,<span class="var type1" id="S8T1U131">i</span>)</span>.cam_param</span>.intrinsic_mat</span>*<span class="mxinfo" id="T1:U89">1000</span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,27" id="srcline27"> 27</a></span><span class="line">        <span class="mxinfo" id="T5:U90"><span class="var type1" id="S18T5U137">Rcw</span> = <span class="mxinfo" id="T5:U92"><span class="mxinfo" id="T4:U93"><span class="mxinfo" id="T53:U94"><span class="var type1" id="S5T2U141">z</span>(<span class="mxinfo" id="T1:U96">1</span>,<span class="var type1" id="S8T1U143">i</span>)</span>.cam_param</span>.rotation_w2c</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,28" id="srcline28"> 28</a></span><span class="line">        <span class="mxinfo" id="T6:U98"><span class="var type1" id="S19T6U148">Tcw</span> = <span class="mxinfo" id="T6:U100"><span class="mxinfo" id="T6:U101"><span class="mxinfo" id="T4:U102"><span class="mxinfo" id="T53:U103"><span class="var type1" id="S5T2U153">z</span>(<span class="mxinfo" id="T1:U105">1</span>,<span class="var type1" id="S8T1U155">i</span>)</span>.cam_param</span>.translation_w2c</span>/<span class="mxinfo" id="T1:U107">1000</span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,29" id="srcline29"> 29</a></span><span class="line">        <span class="comment">% red blobs</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,30" id="srcline30"> 30</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T8:U108"><span class="mxinfo" id="T1:U109"><span class="mxinfo" id="T53:U110"><span class="var type1" id="S5T2U165">z</span>(<span class="mxinfo" id="T1:U112">1</span>,<span class="var type1" id="S8T1U167">i</span>)</span>.number_red</span> == <span class="mxinfo" id="T1:U114">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="77,31" id="srcline31"> 31</a></span><span class="line">            <span class="comment">% do measurement estimation</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,32" id="srcline32"> 32</a></span><span class="line">            <span class="mxinfo" id="T16:U115"><span class="var type1" id="S20T16U172">u</span> = <span class="mxinfo" id="T16:U117"><span class="fcn" id="F378N13:B174">project2_2D</span>(<span class="var type1" id="S17T5U175">A</span>,<span class="var type1" id="S18T5U176">Rcw</span>,<span class="var type1" id="S19T6U177">Tcw</span>,<span class="var type1" id="S14T6U178">Twp</span>,<span class="var type1" id="S15T9U179">qwp</span>,<span class="mxinfo" id="T6:U123"><span class="mxinfo" id="T6:U124"><span class="var type1" id="S6T5U182">object_points</span>(:,<span class="mxinfo" id="T1:U126">1</span>)</span>/<span class="mxinfo" id="T1:U127">1000</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,33" id="srcline33"> 33</a></span><span class="line">            <span class="mxinfo" id="T16:U128"><span class="mxinfo" id="T16:U129"><span class="var type1" id="S12T34U189">z_est</span>(<span class="mxinfo" id="T16:U131"><span class="var type1" id="S16T1U191">k</span>:<span class="mxinfo" id="T1:U133"><span class="var type1" id="S16T1U193">k</span>+1</span></span>,<span class="mxinfo" id="T1:U135">1</span>)</span> = <span class="var type1" id="S20T16U196">u</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="77,34" id="srcline34"> 34</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,35" id="srcline35"> 35</a></span><span class="line">            <span class="comment">% do jacobian calculation</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,36" id="srcline36"> 36</a></span><span class="line">            <span class="mxinfo" id="T5:U137"><span class="var type1" id="S22T5U199">K</span> = <span class="mxinfo" id="T5:U139"><span class="var type1" id="S17T5U201">A</span>*<span class="var type1" id="S18T5U202">Rcw</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,37" id="srcline37"> 37</a></span><span class="line">            <span class="mxinfo" id="T1:U142"><span class="var type1" id="S23T1U205">X</span> = <span class="mxinfo" id="T1:U144"><span class="mxinfo" id="T1:U145"><span class="var type1" id="S6T5U208">object_points</span>(<span class="mxinfo" id="T1:U147">1</span>,<span class="mxinfo" id="T1:U148">1</span>)</span>/<span class="mxinfo" id="T1:U149">1000</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,38" id="srcline38"> 38</a></span><span class="line">            <span class="mxinfo" id="T1:U150"><span class="var type1" id="S24T1U214">Y</span> = <span class="mxinfo" id="T1:U152"><span class="mxinfo" id="T1:U153"><span class="var type1" id="S6T5U217">object_points</span>(<span class="mxinfo" id="T1:U155">2</span>,<span class="mxinfo" id="T1:U156">1</span>)</span>/<span class="mxinfo" id="T1:U157">1000</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,39" id="srcline39"> 39</a></span><span class="line">            <span class="mxinfo" id="T1:U158"><span class="var type1" id="S25T1U223">Z</span> = <span class="mxinfo" id="T1:U160"><span class="mxinfo" id="T1:U161"><span class="var type1" id="S6T5U226">object_points</span>(<span class="mxinfo" id="T1:U163">3</span>,<span class="mxinfo" id="T1:U164">1</span>)</span>/<span class="mxinfo" id="T1:U165">1000</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,40" id="srcline40"> 40</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,41" id="srcline41"> 41</a></span><span class="line">            <span class="comment">% calculate B's</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,42" id="srcline42"> 42</a></span><span class="line">            <span class="mxinfo" id="T1:U166"><span class="var type1" id="S26T1U232">B1</span> = <span class="mxinfo" id="T1:U168"><span class="mxinfo" id="T1:U169"><span class="mxinfo" id="T1:U170"><span class="mxinfo" id="T1:U171"><span class="mxinfo" id="T1:U172">(<span class="mxinfo" id="T1:U173"><span class="mxinfo" id="T1:U174"><span class="mxinfo" id="T1:U175"><span class="mxinfo" id="T1:U176"><span class="mxinfo" id="T1:U177"><span class="var type1" id="S15T9U244">qwp</span>(<span class="mxinfo" id="T1:U179">1</span>)</span>^2</span>+<span class="mxinfo" id="T1:U180"><span class="mxinfo" id="T1:U181"><span class="var type1" id="S15T9U249">qwp</span>(<span class="mxinfo" id="T1:U183">2</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U184"><span class="mxinfo" id="T1:U185"><span class="var type1" id="S15T9U254">qwp</span>(<span class="mxinfo" id="T1:U187">3</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U188"><span class="mxinfo" id="T1:U189"><span class="var type1" id="S15T9U259">qwp</span>(<span class="mxinfo" id="T1:U191">4</span>)</span>^2</span></span>)*<span class="var type1" id="S23T1U262">X</span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo" id="T1:U166"><span class="mxinfo" id="T1:U168"><span class="mxinfo" id="T1:U169"><span class="mxinfo" id="T1:U170"><span class="mxinfo" id="T1:U171">                <span class="mxinfo" id="T1:U193"><span class="mxinfo" id="T1:U194"><span class="mxinfo" id="T1:U195">+ 2</span>*(<span class="mxinfo" id="T1:U196"><span class="mxinfo" id="T1:U197"><span class="mxinfo" id="T1:U198"><span class="var type1" id="S15T9U271">qwp</span>(<span class="mxinfo" id="T1:U200">2</span>)</span>*<span class="mxinfo" id="T1:U201"><span class="var type1" id="S15T9U274">qwp</span>(<span class="mxinfo" id="T1:U203">3</span>)</span></span> - <span class="mxinfo" id="T1:U204"><span class="mxinfo" id="T1:U205"><span class="var type1" id="S15T9U278">qwp</span>(<span class="mxinfo" id="T1:U207">1</span>)</span>*<span class="mxinfo" id="T1:U208"><span class="var type1" id="S15T9U281">qwp</span>(<span class="mxinfo" id="T1:U210">4</span>)</span></span></span>)</span>*<span class="var type1" id="S24T1U283">Y</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo" id="T1:U166"><span class="mxinfo" id="T1:U168"><span class="mxinfo" id="T1:U169"><span class="mxinfo" id="T1:U170">                <span class="mxinfo" id="T1:U212"><span class="mxinfo" id="T1:U213"><span class="mxinfo" id="T1:U214">+ 2</span>*(<span class="mxinfo" id="T1:U215"><span class="mxinfo" id="T1:U216"><span class="mxinfo" id="T1:U217"><span class="var type1" id="S15T9U292">qwp</span>(<span class="mxinfo" id="T1:U219">2</span>)</span>*<span class="mxinfo" id="T1:U220"><span class="var type1" id="S15T9U295">qwp</span>(<span class="mxinfo" id="T1:U222">4</span>)</span></span> + <span class="mxinfo" id="T1:U223"><span class="mxinfo" id="T1:U224"><span class="var type1" id="S15T9U299">qwp</span>(<span class="mxinfo" id="T1:U226">1</span>)</span>*<span class="mxinfo" id="T1:U227"><span class="var type1" id="S15T9U302">qwp</span>(<span class="mxinfo" id="T1:U229">3</span>)</span></span></span>)</span>*<span class="var type1" id="S25T1U304">Z</span></span></span> + <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo" id="T1:U166"><span class="mxinfo" id="T1:U168"><span class="mxinfo" id="T1:U169">                + <span class="mxinfo" id="T1:U231"><span class="var type1" id="S14T6U307">Twp</span>(<span class="mxinfo" id="T1:U233">1</span>)</span></span> - <span class="mxinfo" id="T1:U234"><span class="mxinfo" id="T1:U235"><span class="mxinfo" id="T6:U236"><span class="mxinfo" id="T4:U237"><span class="mxinfo" id="T53:U238"><span class="var type1" id="S5T2U314">z</span>(<span class="mxinfo" id="T1:U240">1</span>,<span class="var type1" id="S8T1U316">i</span>)</span>.cam_param</span>.translation_w2c</span>(<span class="mxinfo" id="T1:U242">1</span>)</span>/<span class="mxinfo" id="T1:U243">1000</span></span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,46" id="srcline46"> 46</a></span><span class="line">            <span class="mxinfo" id="T1:U244"><span class="var type1" id="S27T1U323">B2</span> = <span class="mxinfo" id="T1:U246"><span class="mxinfo" id="T1:U247"><span class="mxinfo" id="T1:U248"><span class="mxinfo" id="T1:U249"><span class="mxinfo" id="T1:U250"><span class="mxinfo" id="T1:U251"><span class="mxinfo" id="T1:U252">2</span>*(<span class="mxinfo" id="T1:U253"><span class="mxinfo" id="T1:U254"><span class="mxinfo" id="T1:U255"><span class="var type1" id="S15T9U335">qwp</span>(<span class="mxinfo" id="T1:U257">2</span>)</span>*<span class="mxinfo" id="T1:U258"><span class="var type1" id="S15T9U338">qwp</span>(<span class="mxinfo" id="T1:U260">3</span>)</span></span> + <span class="mxinfo" id="T1:U261"><span class="mxinfo" id="T1:U262"><span class="var type1" id="S15T9U342">qwp</span>(<span class="mxinfo" id="T1:U264">1</span>)</span>*<span class="mxinfo" id="T1:U265"><span class="var type1" id="S15T9U345">qwp</span>(<span class="mxinfo" id="T1:U267">4</span>)</span></span></span>)</span>*<span class="var type1" id="S23T1U347">X</span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,47" id="srcline47"> 47</a></span><span class="line"><span class="mxinfo" id="T1:U244"><span class="mxinfo" id="T1:U246"><span class="mxinfo" id="T1:U247"><span class="mxinfo" id="T1:U248"><span class="mxinfo" id="T1:U249">                <span class="mxinfo" id="T1:U269">+ (<span class="mxinfo" id="T1:U270"><span class="mxinfo" id="T1:U271"><span class="mxinfo" id="T1:U272"><span class="mxinfo" id="T1:U273"><span class="mxinfo" id="T1:U274"><span class="var type1" id="S15T9U356">qwp</span>(<span class="mxinfo" id="T1:U276">1</span>)</span>^2</span>-<span class="mxinfo" id="T1:U277"><span class="mxinfo" id="T1:U278"><span class="var type1" id="S15T9U361">qwp</span>(<span class="mxinfo" id="T1:U280">2</span>)</span>^2</span></span>+<span class="mxinfo" id="T1:U281"><span class="mxinfo" id="T1:U282"><span class="var type1" id="S15T9U366">qwp</span>(<span class="mxinfo" id="T1:U284">3</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U285"><span class="mxinfo" id="T1:U286"><span class="var type1" id="S15T9U371">qwp</span>(<span class="mxinfo" id="T1:U288">4</span>)</span>^2</span></span>)*<span class="var type1" id="S24T1U374">Y</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,48" id="srcline48"> 48</a></span><span class="line"><span class="mxinfo" id="T1:U244"><span class="mxinfo" id="T1:U246"><span class="mxinfo" id="T1:U247"><span class="mxinfo" id="T1:U248">                <span class="mxinfo" id="T1:U290"><span class="mxinfo" id="T1:U291"><span class="mxinfo" id="T1:U292">+ 2</span>*(<span class="mxinfo" id="T1:U293"><span class="mxinfo" id="T1:U294"><span class="mxinfo" id="T1:U295"><span class="var type1" id="S15T9U383">qwp</span>(<span class="mxinfo" id="T1:U297">3</span>)</span>*<span class="mxinfo" id="T1:U298"><span class="var type1" id="S15T9U386">qwp</span>(<span class="mxinfo" id="T1:U300">4</span>)</span></span> - <span class="mxinfo" id="T1:U301"><span class="mxinfo" id="T1:U302"><span class="var type1" id="S15T9U390">qwp</span>(<span class="mxinfo" id="T1:U304">1</span>)</span>*<span class="mxinfo" id="T1:U305"><span class="var type1" id="S15T9U393">qwp</span>(<span class="mxinfo" id="T1:U307">2</span>)</span></span></span>)</span>*<span class="var type1" id="S25T1U395">Z</span></span></span> + <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo" id="T1:U244"><span class="mxinfo" id="T1:U246"><span class="mxinfo" id="T1:U247">                + <span class="mxinfo" id="T1:U309"><span class="var type1" id="S14T6U398">Twp</span>(<span class="mxinfo" id="T1:U311">2</span>)</span></span> - <span class="mxinfo" id="T1:U312"><span class="mxinfo" id="T1:U313"><span class="mxinfo" id="T6:U314"><span class="mxinfo" id="T4:U315"><span class="mxinfo" id="T53:U316"><span class="var type1" id="S5T2U405">z</span>(<span class="mxinfo" id="T1:U318">1</span>,<span class="var type1" id="S8T1U407">i</span>)</span>.cam_param</span>.translation_w2c</span>(<span class="mxinfo" id="T1:U320">2</span>)</span>/<span class="mxinfo" id="T1:U321">1000</span></span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,50" id="srcline50"> 50</a></span><span class="line">            <span class="mxinfo" id="T1:U322"><span class="var type1" id="S28T1U414">B3</span> = <span class="mxinfo" id="T1:U324"><span class="mxinfo" id="T1:U325"><span class="mxinfo" id="T1:U326"><span class="mxinfo" id="T1:U327"><span class="mxinfo" id="T1:U328"><span class="mxinfo" id="T1:U329"><span class="mxinfo" id="T1:U330">2</span>*(<span class="mxinfo" id="T1:U331"><span class="mxinfo" id="T1:U332"><span class="mxinfo" id="T1:U333"><span class="var type1" id="S15T9U426">qwp</span>(<span class="mxinfo" id="T1:U335">2</span>)</span>*<span class="mxinfo" id="T1:U336"><span class="var type1" id="S15T9U429">qwp</span>(<span class="mxinfo" id="T1:U338">4</span>)</span></span> - <span class="mxinfo" id="T1:U339"><span class="mxinfo" id="T1:U340"><span class="var type1" id="S15T9U433">qwp</span>(<span class="mxinfo" id="T1:U342">1</span>)</span>*<span class="mxinfo" id="T1:U343"><span class="var type1" id="S15T9U436">qwp</span>(<span class="mxinfo" id="T1:U345">3</span>)</span></span></span>)</span>*<span class="var type1" id="S23T1U438">X</span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo" id="T1:U322"><span class="mxinfo" id="T1:U324"><span class="mxinfo" id="T1:U325"><span class="mxinfo" id="T1:U326"><span class="mxinfo" id="T1:U327">                <span class="mxinfo" id="T1:U347"><span class="mxinfo" id="T1:U348"><span class="mxinfo" id="T1:U349">+ 2</span>*(<span class="mxinfo" id="T1:U350"><span class="mxinfo" id="T1:U351"><span class="mxinfo" id="T1:U352"><span class="var type1" id="S15T9U447">qwp</span>(<span class="mxinfo" id="T1:U354">3</span>)</span>*<span class="mxinfo" id="T1:U355"><span class="var type1" id="S15T9U450">qwp</span>(<span class="mxinfo" id="T1:U357">4</span>)</span></span> + <span class="mxinfo" id="T1:U358"><span class="mxinfo" id="T1:U359"><span class="var type1" id="S15T9U454">qwp</span>(<span class="mxinfo" id="T1:U361">1</span>)</span>*<span class="mxinfo" id="T1:U362"><span class="var type1" id="S15T9U457">qwp</span>(<span class="mxinfo" id="T1:U364">2</span>)</span></span></span>)</span>*<span class="var type1" id="S24T1U459">Y</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo" id="T1:U322"><span class="mxinfo" id="T1:U324"><span class="mxinfo" id="T1:U325"><span class="mxinfo" id="T1:U326">                <span class="mxinfo" id="T1:U366">+ (<span class="mxinfo" id="T1:U367"><span class="mxinfo" id="T1:U368"><span class="mxinfo" id="T1:U369"><span class="mxinfo" id="T1:U370"><span class="mxinfo" id="T1:U371"><span class="var type1" id="S15T9U468">qwp</span>(<span class="mxinfo" id="T1:U373">1</span>)</span>^2</span>-<span class="mxinfo" id="T1:U374"><span class="mxinfo" id="T1:U375"><span class="var type1" id="S15T9U473">qwp</span>(<span class="mxinfo" id="T1:U377">2</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U378"><span class="mxinfo" id="T1:U379"><span class="var type1" id="S15T9U478">qwp</span>(<span class="mxinfo" id="T1:U381">3</span>)</span>^2</span></span>+<span class="mxinfo" id="T1:U382"><span class="mxinfo" id="T1:U383"><span class="var type1" id="S15T9U483">qwp</span>(<span class="mxinfo" id="T1:U385">4</span>)</span>^2</span></span>)*<span class="var type1" id="S25T1U486">Z</span></span></span> + <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo" id="T1:U322"><span class="mxinfo" id="T1:U324"><span class="mxinfo" id="T1:U325">                + <span class="mxinfo" id="T1:U387"><span class="var type1" id="S14T6U489">Twp</span>(<span class="mxinfo" id="T1:U389">3</span>)</span></span> - <span class="mxinfo" id="T1:U390"><span class="mxinfo" id="T1:U391"><span class="mxinfo" id="T6:U392"><span class="mxinfo" id="T4:U393"><span class="mxinfo" id="T53:U394"><span class="var type1" id="S5T2U496">z</span>(<span class="mxinfo" id="T1:U396">1</span>,<span class="var type1" id="S8T1U498">i</span>)</span>.cam_param</span>.translation_w2c</span>(<span class="mxinfo" id="T1:U398">3</span>)</span>/<span class="mxinfo" id="T1:U399">1000</span></span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m            </span></span></span>
<span class="srcline"><span class="lineno"><a href="77,54" id="srcline54"> 54</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,55" id="srcline55"> 55</a></span><span class="line">            <span class="mxinfo" id="T1:U400"><span class="var type1" id="S29T1U505">b</span> = <span class="mxinfo" id="T1:U402"><span class="mxinfo" id="T1:U403"><span class="mxinfo" id="T1:U404"><span class="mxinfo" id="T1:U405"><span class="var type1" id="S22T5U510">K</span>(<span class="mxinfo" id="T1:U407">3</span>,<span class="mxinfo" id="T1:U408">1</span>)</span>*<span class="var type1" id="S26T1U513">B1</span></span> + <span class="mxinfo" id="T1:U410"><span class="mxinfo" id="T1:U411"><span class="var type1" id="S22T5U516">K</span>(<span class="mxinfo" id="T1:U413">3</span>,<span class="mxinfo" id="T1:U414">2</span>)</span>*<span class="var type1" id="S27T1U519">B2</span></span></span> + <span class="mxinfo" id="T1:U416"><span class="mxinfo" id="T1:U417"><span class="var type1" id="S22T5U522">K</span>(<span class="mxinfo" id="T1:U419">3</span>,<span class="mxinfo" id="T1:U420">3</span>)</span>*<span class="var type1" id="S28T1U525">B3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,56" id="srcline56"> 56</a></span><span class="line">            <span class="mxinfo" id="T1:U422"><span class="var type1" id="S30T1U528">bu</span> = <span class="var type1" id="S29T1U529">b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,57" id="srcline57"> 57</a></span><span class="line">            <span class="mxinfo" id="T1:U425"><span class="var type1" id="S31T1U532">bv</span> = <span class="var type1" id="S29T1U533">b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,58" id="srcline58"> 58</a></span><span class="line">            <span class="mxinfo" id="T1:U428"><span class="var type1" id="S32T1U536">au</span> = <span class="mxinfo" id="T1:U430"><span class="mxinfo" id="T1:U431"><span class="mxinfo" id="T1:U432"><span class="mxinfo" id="T1:U433"><span class="var type1" id="S22T5U541">K</span>(<span class="mxinfo" id="T1:U435">1</span>,<span class="mxinfo" id="T1:U436">1</span>)</span>*<span class="var type1" id="S26T1U544">B1</span></span> + <span class="mxinfo" id="T1:U438"><span class="mxinfo" id="T1:U439"><span class="var type1" id="S22T5U547">K</span>(<span class="mxinfo" id="T1:U441">1</span>,<span class="mxinfo" id="T1:U442">2</span>)</span>*<span class="var type1" id="S27T1U550">B2</span></span></span> + <span class="mxinfo" id="T1:U444"><span class="mxinfo" id="T1:U445"><span class="var type1" id="S22T5U553">K</span>(<span class="mxinfo" id="T1:U447">1</span>,<span class="mxinfo" id="T1:U448">3</span>)</span>*<span class="var type1" id="S28T1U556">B3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,59" id="srcline59"> 59</a></span><span class="line">            <span class="mxinfo" id="T1:U450"><span class="var type1" id="S33T1U559">av</span> = <span class="mxinfo" id="T1:U452"><span class="mxinfo" id="T1:U453"><span class="mxinfo" id="T1:U454"><span class="mxinfo" id="T1:U455"><span class="var type1" id="S22T5U564">K</span>(<span class="mxinfo" id="T1:U457">2</span>,<span class="mxinfo" id="T1:U458">1</span>)</span>*<span class="var type1" id="S26T1U567">B1</span></span> + <span class="mxinfo" id="T1:U460"><span class="mxinfo" id="T1:U461"><span class="var type1" id="S22T5U570">K</span>(<span class="mxinfo" id="T1:U463">2</span>,<span class="mxinfo" id="T1:U464">2</span>)</span>*<span class="var type1" id="S27T1U573">B2</span></span></span> + <span class="mxinfo" id="T1:U466"><span class="mxinfo" id="T1:U467"><span class="var type1" id="S22T5U576">K</span>(<span class="mxinfo" id="T1:U469">2</span>,<span class="mxinfo" id="T1:U470">3</span>)</span>*<span class="var type1" id="S28T1U579">B3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,60" id="srcline60"> 60</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,61" id="srcline61"> 61</a></span><span class="line">            <span class="mxinfo" id="T18:U472"><span class="var type1" id="S34T18U582">dB1_q</span> = <span class="mxinfo" id="T18:U474">[<span class="mxinfo" id="T1:U475"><span class="mxinfo" id="T1:U476">2</span>*(<span class="mxinfo" id="T1:U477"><span class="mxinfo" id="T1:U478"><span class="mxinfo" id="T1:U479"><span class="mxinfo" id="T1:U480"><span class="var type1" id="S15T9U592">qwp</span>(<span class="mxinfo" id="T1:U482">1</span>)</span>*<span class="var type1" id="S23T1U594">X</span></span> - <span class="mxinfo" id="T1:U484"><span class="mxinfo" id="T1:U485"><span class="var type1" id="S15T9U597">qwp</span>(<span class="mxinfo" id="T1:U487">4</span>)</span>*<span class="var type1" id="S24T1U599">Y</span></span></span> + <span class="mxinfo" id="T1:U489"><span class="mxinfo" id="T1:U490"><span class="var type1" id="S15T9U602">qwp</span>(<span class="mxinfo" id="T1:U492">3</span>)</span>*<span class="var type1" id="S25T1U604">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U494"><span class="mxinfo" id="T1:U495">2</span>*(<span class="mxinfo" id="T1:U496"><span class="mxinfo" id="T1:U497"><span class="mxinfo" id="T1:U498"><span class="mxinfo" id="T1:U499"><span class="var type1" id="S15T9U612">qwp</span>(<span class="mxinfo" id="T1:U501">2</span>)</span>*<span class="var type1" id="S23T1U614">X</span></span> + <span class="mxinfo" id="T1:U503"><span class="mxinfo" id="T1:U504"><span class="var type1" id="S15T9U617">qwp</span>(<span class="mxinfo" id="T1:U506">3</span>)</span>*<span class="var type1" id="S24T1U619">Y</span></span></span> + <span class="mxinfo" id="T1:U508"><span class="mxinfo" id="T1:U509"><span class="var type1" id="S15T9U622">qwp</span>(<span class="mxinfo" id="T1:U511">4</span>)</span>*<span class="var type1" id="S25T1U624">Z</span></span></span>)</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo" id="T18:U472"><span class="mxinfo" id="T18:U474">                    <span class="mxinfo" id="T1:U513"><span class="mxinfo" id="T1:U514">2</span>*(<span class="mxinfo" id="T1:U515"><span class="mxinfo" id="T1:U516"><span class="mxinfo" id="T1:U517"><span class="mxinfo" id="T1:U518">-<span class="mxinfo" id="T1:U519"><span class="var type1" id="S15T9U633">qwp</span>(<span class="mxinfo" id="T1:U521">3</span>)</span></span>*<span class="var type1" id="S23T1U635">X</span></span> + <span class="mxinfo" id="T1:U523"><span class="mxinfo" id="T1:U524"><span class="var type1" id="S15T9U638">qwp</span>(<span class="mxinfo" id="T1:U526">2</span>)</span>*<span class="var type1" id="S24T1U640">Y</span></span></span> + <span class="mxinfo" id="T1:U528"><span class="mxinfo" id="T1:U529"><span class="var type1" id="S15T9U643">qwp</span>(<span class="mxinfo" id="T1:U531">1</span>)</span>*<span class="var type1" id="S25T1U645">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U533"><span class="mxinfo" id="T1:U534">2</span>*(<span class="mxinfo" id="T1:U535"><span class="mxinfo" id="T1:U536"><span class="mxinfo" id="T1:U537"><span class="mxinfo" id="T1:U538">-<span class="mxinfo" id="T1:U539"><span class="var type1" id="S15T9U654">qwp</span>(<span class="mxinfo" id="T1:U541">4</span>)</span></span>*<span class="var type1" id="S23T1U656">X</span></span> - <span class="mxinfo" id="T1:U543"><span class="mxinfo" id="T1:U544"><span class="var type1" id="S15T9U659">qwp</span>(<span class="mxinfo" id="T1:U546">1</span>)</span>*<span class="var type1" id="S24T1U661">Y</span></span></span> + <span class="mxinfo" id="T1:U548"><span class="mxinfo" id="T1:U549"><span class="var type1" id="S15T9U664">qwp</span>(<span class="mxinfo" id="T1:U551">2</span>)</span>*<span class="var type1" id="S25T1U666">Z</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,63" id="srcline63"> 63</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="77,64" id="srcline64"> 64</a></span><span class="line">            <span class="mxinfo" id="T18:U553"><span class="var type1" id="S35T18U669">dB2_q</span> = <span class="mxinfo" id="T18:U555">[<span class="mxinfo" id="T1:U556"><span class="mxinfo" id="T1:U557">2</span>*(<span class="mxinfo" id="T1:U558"><span class="mxinfo" id="T1:U559"><span class="mxinfo" id="T1:U560"><span class="mxinfo" id="T1:U561"><span class="var type1" id="S15T9U679">qwp</span>(<span class="mxinfo" id="T1:U563">4</span>)</span>*<span class="var type1" id="S23T1U681">X</span></span> + <span class="mxinfo" id="T1:U565"><span class="mxinfo" id="T1:U566"><span class="var type1" id="S15T9U684">qwp</span>(<span class="mxinfo" id="T1:U568">1</span>)</span>*<span class="var type1" id="S24T1U686">Y</span></span></span> - <span class="mxinfo" id="T1:U570"><span class="mxinfo" id="T1:U571"><span class="var type1" id="S15T9U689">qwp</span>(<span class="mxinfo" id="T1:U573">2</span>)</span>*<span class="var type1" id="S25T1U691">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U575"><span class="mxinfo" id="T1:U576">2</span>*(<span class="mxinfo" id="T1:U577"><span class="mxinfo" id="T1:U578"><span class="mxinfo" id="T1:U579"><span class="mxinfo" id="T1:U580"><span class="var type1" id="S15T9U699">qwp</span>(<span class="mxinfo" id="T1:U582">3</span>)</span>*<span class="var type1" id="S23T1U701">X</span></span> - <span class="mxinfo" id="T1:U584"><span class="mxinfo" id="T1:U585"><span class="var type1" id="S15T9U704">qwp</span>(<span class="mxinfo" id="T1:U587">2</span>)</span>*<span class="var type1" id="S24T1U706">Y</span></span></span> - <span class="mxinfo" id="T1:U589"><span class="mxinfo" id="T1:U590"><span class="var type1" id="S15T9U709">qwp</span>(<span class="mxinfo" id="T1:U592">1</span>)</span>*<span class="var type1" id="S25T1U711">Z</span></span></span>)</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo" id="T18:U553"><span class="mxinfo" id="T18:U555">                    <span class="mxinfo" id="T1:U594"><span class="mxinfo" id="T1:U595">2</span>*(<span class="mxinfo" id="T1:U596"><span class="mxinfo" id="T1:U597"><span class="mxinfo" id="T1:U598"><span class="mxinfo" id="T1:U599"><span class="var type1" id="S15T9U719">qwp</span>(<span class="mxinfo" id="T1:U601">2</span>)</span>*<span class="var type1" id="S23T1U721">X</span></span> + <span class="mxinfo" id="T1:U603"><span class="mxinfo" id="T1:U604"><span class="var type1" id="S15T9U724">qwp</span>(<span class="mxinfo" id="T1:U606">3</span>)</span>*<span class="var type1" id="S24T1U726">Y</span></span></span> + <span class="mxinfo" id="T1:U608"><span class="mxinfo" id="T1:U609"><span class="var type1" id="S15T9U729">qwp</span>(<span class="mxinfo" id="T1:U611">4</span>)</span>*<span class="var type1" id="S25T1U731">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U613"><span class="mxinfo" id="T1:U614">2</span>*(<span class="mxinfo" id="T1:U615"><span class="mxinfo" id="T1:U616"><span class="mxinfo" id="T1:U617"><span class="mxinfo" id="T1:U618"><span class="var type1" id="S15T9U739">qwp</span>(<span class="mxinfo" id="T1:U620">1</span>)</span>*<span class="var type1" id="S23T1U741">X</span></span> - <span class="mxinfo" id="T1:U622"><span class="mxinfo" id="T1:U623"><span class="var type1" id="S15T9U744">qwp</span>(<span class="mxinfo" id="T1:U625">4</span>)</span>*<span class="var type1" id="S24T1U746">Y</span></span></span> + <span class="mxinfo" id="T1:U627"><span class="mxinfo" id="T1:U628"><span class="var type1" id="S15T9U749">qwp</span>(<span class="mxinfo" id="T1:U630">3</span>)</span>*<span class="var type1" id="S25T1U751">Z</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,66" id="srcline66"> 66</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="77,67" id="srcline67"> 67</a></span><span class="line">            <span class="mxinfo" id="T18:U632"><span class="var type1" id="S36T18U754">dB3_q</span> = <span class="mxinfo" id="T18:U634">[<span class="mxinfo" id="T1:U635"><span class="mxinfo" id="T1:U636">2</span>*(<span class="mxinfo" id="T1:U637"><span class="mxinfo" id="T1:U638"><span class="mxinfo" id="T1:U639"><span class="mxinfo" id="T1:U640">-<span class="mxinfo" id="T1:U641"><span class="var type1" id="S15T9U765">qwp</span>(<span class="mxinfo" id="T1:U643">3</span>)</span></span>*<span class="var type1" id="S23T1U767">X</span></span> + <span class="mxinfo" id="T1:U645"><span class="mxinfo" id="T1:U646"><span class="var type1" id="S15T9U770">qwp</span>(<span class="mxinfo" id="T1:U648">2</span>)</span>*<span class="var type1" id="S24T1U772">Y</span></span></span> + <span class="mxinfo" id="T1:U650"><span class="mxinfo" id="T1:U651"><span class="var type1" id="S15T9U775">qwp</span>(<span class="mxinfo" id="T1:U653">1</span>)</span>*<span class="var type1" id="S25T1U777">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U655"><span class="mxinfo" id="T1:U656">2</span>*(<span class="mxinfo" id="T1:U657"><span class="mxinfo" id="T1:U658"><span class="mxinfo" id="T1:U659"><span class="mxinfo" id="T1:U660"><span class="var type1" id="S15T9U785">qwp</span>(<span class="mxinfo" id="T1:U662">4</span>)</span>*<span class="var type1" id="S23T1U787">X</span></span> + <span class="mxinfo" id="T1:U664"><span class="mxinfo" id="T1:U665"><span class="var type1" id="S15T9U790">qwp</span>(<span class="mxinfo" id="T1:U667">1</span>)</span>*<span class="var type1" id="S24T1U792">Y</span></span></span> - <span class="mxinfo" id="T1:U669"><span class="mxinfo" id="T1:U670"><span class="var type1" id="S15T9U795">qwp</span>(<span class="mxinfo" id="T1:U672">2</span>)</span>*<span class="var type1" id="S25T1U797">Z</span></span></span>)</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo" id="T18:U632"><span class="mxinfo" id="T18:U634">                    <span class="mxinfo" id="T1:U674"><span class="mxinfo" id="T1:U675">2</span>*(<span class="mxinfo" id="T1:U676"><span class="mxinfo" id="T1:U677"><span class="mxinfo" id="T1:U678"><span class="mxinfo" id="T1:U679">-<span class="mxinfo" id="T1:U680"><span class="var type1" id="S15T9U806">qwp</span>(<span class="mxinfo" id="T1:U682">1</span>)</span></span>*<span class="var type1" id="S23T1U808">X</span></span> + <span class="mxinfo" id="T1:U684"><span class="mxinfo" id="T1:U685"><span class="var type1" id="S15T9U811">qwp</span>(<span class="mxinfo" id="T1:U687">4</span>)</span>*<span class="var type1" id="S24T1U813">Y</span></span></span> - <span class="mxinfo" id="T1:U689"><span class="mxinfo" id="T1:U690"><span class="var type1" id="S15T9U816">qwp</span>(<span class="mxinfo" id="T1:U692">3</span>)</span>*<span class="var type1" id="S25T1U818">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U694"><span class="mxinfo" id="T1:U695">2</span>*(<span class="mxinfo" id="T1:U696"><span class="mxinfo" id="T1:U697"><span class="mxinfo" id="T1:U698"><span class="mxinfo" id="T1:U699"><span class="var type1" id="S15T9U826">qwp</span>(<span class="mxinfo" id="T1:U701">2</span>)</span>*<span class="var type1" id="S23T1U828">X</span></span> + <span class="mxinfo" id="T1:U703"><span class="mxinfo" id="T1:U704"><span class="var type1" id="S15T9U831">qwp</span>(<span class="mxinfo" id="T1:U706">3</span>)</span>*<span class="var type1" id="S24T1U833">Y</span></span></span> + <span class="mxinfo" id="T1:U708"><span class="mxinfo" id="T1:U709"><span class="var type1" id="S15T9U836">qwp</span>(<span class="mxinfo" id="T1:U711">4</span>)</span>*<span class="var type1" id="S25T1U838">Z</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,69" id="srcline69"> 69</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="77,70" id="srcline70"> 70</a></span><span class="line">            <span class="mxinfo" id="T47:U713"><span class="var type1" id="S37T47U841">dB1_x</span> = <span class="mxinfo" id="T47:U715">[<span class="mxinfo" id="T1:U716">1</span> <span class="mxinfo" id="T1:U717">0</span> <span class="mxinfo" id="T1:U718">0</span> <span class="var type1" id="S34T18U847">dB1_q</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,71" id="srcline71"> 71</a></span><span class="line">            <span class="mxinfo" id="T47:U720"><span class="var type1" id="S38T47U850">dB2_x</span> = <span class="mxinfo" id="T47:U722">[<span class="mxinfo" id="T1:U723">0</span> <span class="mxinfo" id="T1:U724">1</span> <span class="mxinfo" id="T1:U725">0</span> <span class="var type1" id="S35T18U856">dB2_q</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,72" id="srcline72"> 72</a></span><span class="line">            <span class="mxinfo" id="T47:U727"><span class="var type1" id="S39T47U859">dB3_x</span> = <span class="mxinfo" id="T47:U729">[<span class="mxinfo" id="T1:U730">0</span> <span class="mxinfo" id="T1:U731">0</span> <span class="mxinfo" id="T1:U732">1</span> <span class="var type1" id="S36T18U865">dB3_q</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,73" id="srcline73"> 73</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,74" id="srcline74"> 74</a></span><span class="line">            <span class="mxinfo" id="T47:U734"><span class="var type1" id="S40T47U868">au_prime</span> = <span class="mxinfo" id="T47:U736"><span class="mxinfo" id="T47:U737"><span class="mxinfo" id="T47:U738"><span class="mxinfo" id="T1:U739"><span class="var type1" id="S22T5U873">K</span>(<span class="mxinfo" id="T1:U741">1</span>,<span class="mxinfo" id="T1:U742">1</span>)</span>*<span class="var type1" id="S37T47U876">dB1_x</span></span> + <span class="mxinfo" id="T47:U744"><span class="mxinfo" id="T1:U745"><span class="var type1" id="S22T5U879">K</span>(<span class="mxinfo" id="T1:U747">1</span>,<span class="mxinfo" id="T1:U748">2</span>)</span>*<span class="var type1" id="S38T47U882">dB2_x</span></span></span> + <span class="mxinfo" id="T47:U750"><span class="mxinfo" id="T1:U751"><span class="var type1" id="S22T5U885">K</span>(<span class="mxinfo" id="T1:U753">1</span>,<span class="mxinfo" id="T1:U754">3</span>)</span>*<span class="var type1" id="S39T47U888">dB3_x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,75" id="srcline75"> 75</a></span><span class="line">            <span class="mxinfo" id="T47:U756"><span class="var type1" id="S41T47U891">av_prime</span> = <span class="mxinfo" id="T47:U758"><span class="mxinfo" id="T47:U759"><span class="mxinfo" id="T47:U760"><span class="mxinfo" id="T1:U761"><span class="var type1" id="S22T5U896">K</span>(<span class="mxinfo" id="T1:U763">2</span>,<span class="mxinfo" id="T1:U764">1</span>)</span>*<span class="var type1" id="S37T47U899">dB1_x</span></span> + <span class="mxinfo" id="T47:U766"><span class="mxinfo" id="T1:U767"><span class="var type1" id="S22T5U902">K</span>(<span class="mxinfo" id="T1:U769">2</span>,<span class="mxinfo" id="T1:U770">2</span>)</span>*<span class="var type1" id="S38T47U905">dB2_x</span></span></span> + <span class="mxinfo" id="T47:U772"><span class="mxinfo" id="T1:U773"><span class="var type1" id="S22T5U908">K</span>(<span class="mxinfo" id="T1:U775">2</span>,<span class="mxinfo" id="T1:U776">3</span>)</span>*<span class="var type1" id="S39T47U911">dB3_x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,76" id="srcline76"> 76</a></span><span class="line">            <span class="mxinfo" id="T47:U778"><span class="var type1" id="S42T47U914">b_prime</span> = <span class="mxinfo" id="T47:U780"><span class="mxinfo" id="T47:U781"><span class="mxinfo" id="T47:U782"><span class="mxinfo" id="T1:U783"><span class="var type1" id="S22T5U919">K</span>(<span class="mxinfo" id="T1:U785">3</span>,<span class="mxinfo" id="T1:U786">1</span>)</span>*<span class="var type1" id="S37T47U922">dB1_x</span></span> + <span class="mxinfo" id="T47:U788"><span class="mxinfo" id="T1:U789"><span class="var type1" id="S22T5U925">K</span>(<span class="mxinfo" id="T1:U791">3</span>,<span class="mxinfo" id="T1:U792">2</span>)</span>*<span class="var type1" id="S38T47U928">dB2_x</span></span></span> + <span class="mxinfo" id="T47:U794"><span class="mxinfo" id="T1:U795"><span class="var type1" id="S22T5U931">K</span>(<span class="mxinfo" id="T1:U797">3</span>,<span class="mxinfo" id="T1:U798">3</span>)</span>*<span class="var type1" id="S39T47U934">dB3_x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,77" id="srcline77"> 77</a></span><span class="line">            <span class="mxinfo" id="T47:U800"><span class="var type1" id="S43T47U937">bu_prime</span> = <span class="var type1" id="S42T47U938">b_prime</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,78" id="srcline78"> 78</a></span><span class="line">            <span class="mxinfo" id="T47:U803"><span class="var type1" id="S44T47U941">bv_prime</span> = <span class="var type1" id="S42T47U942">b_prime</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="77,79" id="srcline79"> 79</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,80" id="srcline80"> 80</a></span><span class="line">            <span class="mxinfo" id="T1:U806"><span class="var type1" id="S45T1U945">b_sq</span> = <span class="mxinfo" id="T1:U808"><span class="var type1" id="S29T1U947">b</span>^2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,81" id="srcline81"> 81</a></span><span class="line">            <span class="mxinfo" id="T47:U810"><span class="var type1" id="S46T47U951">du_dx</span> = <span class="mxinfo" id="T47:U812">(<span class="mxinfo" id="T47:U813"><span class="mxinfo" id="T47:U814"><span class="var type1" id="S40T47U956">au_prime</span>*<span class="var type1" id="S30T1U957">bu</span></span> - <span class="mxinfo" id="T47:U817"><span class="var type1" id="S32T1U959">au</span>*<span class="var type1" id="S43T47U960">bu_prime</span></span></span>)/<span class="var type1" id="S45T1U961">b_sq</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,82" id="srcline82"> 82</a></span><span class="line">            <span class="mxinfo" id="T47:U821"><span class="var type1" id="S47T47U964">dv_dx</span> = <span class="mxinfo" id="T47:U823">(<span class="mxinfo" id="T47:U824"><span class="mxinfo" id="T47:U825"><span class="var type1" id="S41T47U969">av_prime</span>*<span class="var type1" id="S31T1U970">bv</span></span> - <span class="mxinfo" id="T47:U828"><span class="var type1" id="S33T1U972">av</span>*<span class="var type1" id="S44T47U973">bv_prime</span></span></span>)/<span class="var type1" id="S45T1U974">b_sq</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,83" id="srcline83"> 83</a></span><span class="line">            <span class="mxinfo" id="T64:U832"><span class="mxinfo" id="T64:U833"><span class="var type1" id="S9T48U978">A_lin</span>(<span class="mxinfo" id="T16:U835"><span class="var type1" id="S16T1U980">k</span>:<span class="mxinfo" id="T1:U837"><span class="var type1" id="S16T1U982">k</span>+1</span></span>,:)</span> = <span class="mxinfo" id="T64:U839">[<span class="var type1" id="S46T47U987">du_dx</span>;<span class="var type1" id="S47T47U989">dv_dx</span>]</span></span>;     </span></span>
<span class="srcline"><span class="lineno"><a href="77,84" id="srcline84"> 84</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,85" id="srcline85"> 85</a></span><span class="line">            <span class="mxinfo" id="T1:U842"><span class="mxinfo" id="T1:U843"><span class="var type1" id="S13T34U993">z_meas</span>(<span class="var type1" id="S16T1U994">k</span>,<span class="mxinfo" id="T1:U846">1</span>)</span> = <span class="mxinfo" id="T1:U847"><span class="mxinfo" id="T3:U848"><span class="mxinfo" id="T53:U849"><span class="var type1" id="S5T2U999">z</span>(<span class="mxinfo" id="T1:U851">1</span>,<span class="var type1" id="S8T1U1001">i</span>)</span>.red_data</span>(<span class="mxinfo" id="T1:U853">1</span>,<span class="mxinfo" id="T1:U854">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,86" id="srcline86"> 86</a></span><span class="line">            <span class="mxinfo" id="T1:U855"><span class="mxinfo" id="T1:U856"><span class="var type1" id="S13T34U1008">z_meas</span>(<span class="mxinfo" id="T1:U858"><span class="var type1" id="S16T1U1010">k</span>+<span class="mxinfo" id="T1:U860">1</span></span>,<span class="mxinfo" id="T1:U861">1</span>)</span> = <span class="mxinfo" id="T1:U862"><span class="mxinfo" id="T3:U863"><span class="mxinfo" id="T53:U864"><span class="var type1" id="S5T2U1016">z</span>(<span class="mxinfo" id="T1:U866">1</span>,<span class="var type1" id="S8T1U1018">i</span>)</span>.red_data</span>(<span class="mxinfo" id="T1:U868">1</span>,<span class="mxinfo" id="T1:U869">2</span>)</span></span>;             </span></span>
<span class="srcline"><span class="lineno"><a href="77,87" id="srcline87"> 87</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,88" id="srcline88"> 88</a></span><span class="line">            <span class="mxinfo" id="T1:U870"><span class="var type1" id="S16T1U1024">k</span> = <span class="mxinfo" id="T1:U872"><span class="var type1" id="S16T1U1026">k</span> + <span class="mxinfo" id="T1:U874">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,89" id="srcline89"> 89</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,90" id="srcline90"> 90</a></span><span class="line">        <span class="comment">% green blobs</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,91" id="srcline91"> 91</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T8:U875"><span class="mxinfo" id="T1:U876"><span class="mxinfo" id="T53:U877"><span class="var type1" id="S5T2U1034">z</span>(<span class="mxinfo" id="T1:U879">1</span>,<span class="var type1" id="S8T1U1036">i</span>)</span>.number_green</span> == <span class="mxinfo" id="T1:U881">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="77,92" id="srcline92"> 92</a></span><span class="line">            <span class="comment">% do measurement estimation</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,93" id="srcline93"> 93</a></span><span class="line">            <span class="mxinfo" id="T16:U882"><span class="var type1" id="S20T16U1041">u</span> = <span class="mxinfo" id="T16:U884"><span class="fcn" id="F378N13:B1043">project2_2D</span>(<span class="var type1" id="S17T5U1044">A</span>,<span class="var type1" id="S18T5U1045">Rcw</span>,<span class="var type1" id="S19T6U1046">Tcw</span>,<span class="var type1" id="S14T6U1047">Twp</span>,<span class="var type1" id="S15T9U1048">qwp</span>,<span class="mxinfo" id="T6:U890"><span class="mxinfo" id="T6:U891"><span class="var type1" id="S6T5U1051">object_points</span>(:,<span class="mxinfo" id="T1:U893">2</span>)</span>/<span class="mxinfo" id="T1:U894">1000</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,94" id="srcline94"> 94</a></span><span class="line">            <span class="mxinfo" id="T16:U895"><span class="mxinfo" id="T16:U896"><span class="var type1" id="S12T34U1058">z_est</span>(<span class="mxinfo" id="T16:U898"><span class="var type1" id="S16T1U1060">k</span>:<span class="mxinfo" id="T1:U900"><span class="var type1" id="S16T1U1062">k</span>+1</span></span>,<span class="mxinfo" id="T1:U902">1</span>)</span> = <span class="var type1" id="S20T16U1065">u</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,95" id="srcline95"> 95</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,96" id="srcline96"> 96</a></span><span class="line">            <span class="comment">% do jacobian calc</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,97" id="srcline97"> 97</a></span><span class="line">            <span class="mxinfo" id="T5:U904"><span class="var type1" id="S22T5U1068">K</span> = <span class="mxinfo" id="T5:U906"><span class="var type1" id="S17T5U1070">A</span>*<span class="var type1" id="S18T5U1071">Rcw</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,98" id="srcline98"> 98</a></span><span class="line">            <span class="mxinfo" id="T1:U909"><span class="var type1" id="S23T1U1074">X</span> = <span class="mxinfo" id="T1:U911"><span class="mxinfo" id="T1:U912"><span class="var type1" id="S6T5U1077">object_points</span>(<span class="mxinfo" id="T1:U914">1</span>,<span class="mxinfo" id="T1:U915">2</span>)</span>/<span class="mxinfo" id="T1:U916">1000</span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,99" id="srcline99"> 99</a></span><span class="line">            <span class="mxinfo" id="T1:U917"><span class="var type1" id="S24T1U1083">Y</span> = <span class="mxinfo" id="T1:U919"><span class="mxinfo" id="T1:U920"><span class="var type1" id="S6T5U1086">object_points</span>(<span class="mxinfo" id="T1:U922">2</span>,<span class="mxinfo" id="T1:U923">2</span>)</span>/<span class="mxinfo" id="T1:U924">1000</span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,100" id="srcline100">100</a></span><span class="line">            <span class="mxinfo" id="T1:U925"><span class="var type1" id="S25T1U1092">Z</span> = <span class="mxinfo" id="T1:U927"><span class="mxinfo" id="T1:U928"><span class="var type1" id="S6T5U1095">object_points</span>(<span class="mxinfo" id="T1:U930">3</span>,<span class="mxinfo" id="T1:U931">2</span>)</span>/<span class="mxinfo" id="T1:U932">1000</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,101" id="srcline101">101</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,102" id="srcline102">102</a></span><span class="line">            <span class="comment">% calculate B's</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,103" id="srcline103">103</a></span><span class="line">            <span class="mxinfo" id="T1:U933"><span class="var type1" id="S26T1U1101">B1</span> = <span class="mxinfo" id="T1:U935"><span class="mxinfo" id="T1:U936"><span class="mxinfo" id="T1:U937"><span class="mxinfo" id="T1:U938"><span class="mxinfo" id="T1:U939">(<span class="mxinfo" id="T1:U940"><span class="mxinfo" id="T1:U941"><span class="mxinfo" id="T1:U942"><span class="mxinfo" id="T1:U943"><span class="mxinfo" id="T1:U944"><span class="var type1" id="S15T9U1113">qwp</span>(<span class="mxinfo" id="T1:U946">1</span>)</span>^2</span>+<span class="mxinfo" id="T1:U947"><span class="mxinfo" id="T1:U948"><span class="var type1" id="S15T9U1118">qwp</span>(<span class="mxinfo" id="T1:U950">2</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U951"><span class="mxinfo" id="T1:U952"><span class="var type1" id="S15T9U1123">qwp</span>(<span class="mxinfo" id="T1:U954">3</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U955"><span class="mxinfo" id="T1:U956"><span class="var type1" id="S15T9U1128">qwp</span>(<span class="mxinfo" id="T1:U958">4</span>)</span>^2</span></span>)*<span class="var type1" id="S23T1U1131">X</span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,104" id="srcline104">104</a></span><span class="line"><span class="mxinfo" id="T1:U933"><span class="mxinfo" id="T1:U935"><span class="mxinfo" id="T1:U936"><span class="mxinfo" id="T1:U937"><span class="mxinfo" id="T1:U938">                <span class="mxinfo" id="T1:U960"><span class="mxinfo" id="T1:U961"><span class="mxinfo" id="T1:U962">+ 2</span>*(<span class="mxinfo" id="T1:U963"><span class="mxinfo" id="T1:U964"><span class="mxinfo" id="T1:U965"><span class="var type1" id="S15T9U1140">qwp</span>(<span class="mxinfo" id="T1:U967">2</span>)</span>*<span class="mxinfo" id="T1:U968"><span class="var type1" id="S15T9U1143">qwp</span>(<span class="mxinfo" id="T1:U970">3</span>)</span></span> - <span class="mxinfo" id="T1:U971"><span class="mxinfo" id="T1:U972"><span class="var type1" id="S15T9U1147">qwp</span>(<span class="mxinfo" id="T1:U974">1</span>)</span>*<span class="mxinfo" id="T1:U975"><span class="var type1" id="S15T9U1150">qwp</span>(<span class="mxinfo" id="T1:U977">4</span>)</span></span></span>)</span>*<span class="var type1" id="S24T1U1152">Y</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo" id="T1:U933"><span class="mxinfo" id="T1:U935"><span class="mxinfo" id="T1:U936"><span class="mxinfo" id="T1:U937">                <span class="mxinfo" id="T1:U979"><span class="mxinfo" id="T1:U980"><span class="mxinfo" id="T1:U981">+ 2</span>*(<span class="mxinfo" id="T1:U982"><span class="mxinfo" id="T1:U983"><span class="mxinfo" id="T1:U984"><span class="var type1" id="S15T9U1161">qwp</span>(<span class="mxinfo" id="T1:U986">2</span>)</span>*<span class="mxinfo" id="T1:U987"><span class="var type1" id="S15T9U1164">qwp</span>(<span class="mxinfo" id="T1:U989">4</span>)</span></span> + <span class="mxinfo" id="T1:U990"><span class="mxinfo" id="T1:U991"><span class="var type1" id="S15T9U1168">qwp</span>(<span class="mxinfo" id="T1:U993">1</span>)</span>*<span class="mxinfo" id="T1:U994"><span class="var type1" id="S15T9U1171">qwp</span>(<span class="mxinfo" id="T1:U996">3</span>)</span></span></span>)</span>*<span class="var type1" id="S25T1U1173">Z</span></span></span> + <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo" id="T1:U933"><span class="mxinfo" id="T1:U935"><span class="mxinfo" id="T1:U936">                + <span class="mxinfo" id="T1:U998"><span class="var type1" id="S14T6U1176">Twp</span>(<span class="mxinfo" id="T1:U1000">1</span>)</span></span> - <span class="mxinfo" id="T1:U1001"><span class="mxinfo" id="T1:U1002"><span class="mxinfo" id="T6:U1003"><span class="mxinfo" id="T4:U1004"><span class="mxinfo" id="T53:U1005"><span class="var type1" id="S5T2U1183">z</span>(<span class="mxinfo" id="T1:U1007">1</span>,<span class="var type1" id="S8T1U1185">i</span>)</span>.cam_param</span>.translation_w2c</span>(<span class="mxinfo" id="T1:U1009">1</span>)</span>/<span class="mxinfo" id="T1:U1010">1000</span></span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,107" id="srcline107">107</a></span><span class="line">            <span class="mxinfo" id="T1:U1011"><span class="var type1" id="S27T1U1192">B2</span> = <span class="mxinfo" id="T1:U1013"><span class="mxinfo" id="T1:U1014"><span class="mxinfo" id="T1:U1015"><span class="mxinfo" id="T1:U1016"><span class="mxinfo" id="T1:U1017"><span class="mxinfo" id="T1:U1018"><span class="mxinfo" id="T1:U1019">2</span>*(<span class="mxinfo" id="T1:U1020"><span class="mxinfo" id="T1:U1021"><span class="mxinfo" id="T1:U1022"><span class="var type1" id="S15T9U1204">qwp</span>(<span class="mxinfo" id="T1:U1024">2</span>)</span>*<span class="mxinfo" id="T1:U1025"><span class="var type1" id="S15T9U1207">qwp</span>(<span class="mxinfo" id="T1:U1027">3</span>)</span></span> + <span class="mxinfo" id="T1:U1028"><span class="mxinfo" id="T1:U1029"><span class="var type1" id="S15T9U1211">qwp</span>(<span class="mxinfo" id="T1:U1031">1</span>)</span>*<span class="mxinfo" id="T1:U1032"><span class="var type1" id="S15T9U1214">qwp</span>(<span class="mxinfo" id="T1:U1034">4</span>)</span></span></span>)</span>*<span class="var type1" id="S23T1U1216">X</span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo" id="T1:U1011"><span class="mxinfo" id="T1:U1013"><span class="mxinfo" id="T1:U1014"><span class="mxinfo" id="T1:U1015"><span class="mxinfo" id="T1:U1016">                <span class="mxinfo" id="T1:U1036">+ (<span class="mxinfo" id="T1:U1037"><span class="mxinfo" id="T1:U1038"><span class="mxinfo" id="T1:U1039"><span class="mxinfo" id="T1:U1040"><span class="mxinfo" id="T1:U1041"><span class="var type1" id="S15T9U1225">qwp</span>(<span class="mxinfo" id="T1:U1043">1</span>)</span>^2</span>-<span class="mxinfo" id="T1:U1044"><span class="mxinfo" id="T1:U1045"><span class="var type1" id="S15T9U1230">qwp</span>(<span class="mxinfo" id="T1:U1047">2</span>)</span>^2</span></span>+<span class="mxinfo" id="T1:U1048"><span class="mxinfo" id="T1:U1049"><span class="var type1" id="S15T9U1235">qwp</span>(<span class="mxinfo" id="T1:U1051">3</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U1052"><span class="mxinfo" id="T1:U1053"><span class="var type1" id="S15T9U1240">qwp</span>(<span class="mxinfo" id="T1:U1055">4</span>)</span>^2</span></span>)*<span class="var type1" id="S24T1U1243">Y</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo" id="T1:U1011"><span class="mxinfo" id="T1:U1013"><span class="mxinfo" id="T1:U1014"><span class="mxinfo" id="T1:U1015">                <span class="mxinfo" id="T1:U1057"><span class="mxinfo" id="T1:U1058"><span class="mxinfo" id="T1:U1059">+ 2</span>*(<span class="mxinfo" id="T1:U1060"><span class="mxinfo" id="T1:U1061"><span class="mxinfo" id="T1:U1062"><span class="var type1" id="S15T9U1252">qwp</span>(<span class="mxinfo" id="T1:U1064">3</span>)</span>*<span class="mxinfo" id="T1:U1065"><span class="var type1" id="S15T9U1255">qwp</span>(<span class="mxinfo" id="T1:U1067">4</span>)</span></span> - <span class="mxinfo" id="T1:U1068"><span class="mxinfo" id="T1:U1069"><span class="var type1" id="S15T9U1259">qwp</span>(<span class="mxinfo" id="T1:U1071">1</span>)</span>*<span class="mxinfo" id="T1:U1072"><span class="var type1" id="S15T9U1262">qwp</span>(<span class="mxinfo" id="T1:U1074">2</span>)</span></span></span>)</span>*<span class="var type1" id="S25T1U1264">Z</span></span></span> + <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,110" id="srcline110">110</a></span><span class="line"><span class="mxinfo" id="T1:U1011"><span class="mxinfo" id="T1:U1013"><span class="mxinfo" id="T1:U1014">                + <span class="mxinfo" id="T1:U1076"><span class="var type1" id="S14T6U1267">Twp</span>(<span class="mxinfo" id="T1:U1078">2</span>)</span></span> - <span class="mxinfo" id="T1:U1079"><span class="mxinfo" id="T1:U1080"><span class="mxinfo" id="T6:U1081"><span class="mxinfo" id="T4:U1082"><span class="mxinfo" id="T53:U1083"><span class="var type1" id="S5T2U1274">z</span>(<span class="mxinfo" id="T1:U1085">1</span>,<span class="var type1" id="S8T1U1276">i</span>)</span>.cam_param</span>.translation_w2c</span>(<span class="mxinfo" id="T1:U1087">2</span>)</span>/<span class="mxinfo" id="T1:U1088">1000</span></span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,111" id="srcline111">111</a></span><span class="line">            <span class="mxinfo" id="T1:U1089"><span class="var type1" id="S28T1U1283">B3</span> = <span class="mxinfo" id="T1:U1091"><span class="mxinfo" id="T1:U1092"><span class="mxinfo" id="T1:U1093"><span class="mxinfo" id="T1:U1094"><span class="mxinfo" id="T1:U1095"><span class="mxinfo" id="T1:U1096"><span class="mxinfo" id="T1:U1097">2</span>*(<span class="mxinfo" id="T1:U1098"><span class="mxinfo" id="T1:U1099"><span class="mxinfo" id="T1:U1100"><span class="var type1" id="S15T9U1295">qwp</span>(<span class="mxinfo" id="T1:U1102">2</span>)</span>*<span class="mxinfo" id="T1:U1103"><span class="var type1" id="S15T9U1298">qwp</span>(<span class="mxinfo" id="T1:U1105">4</span>)</span></span> - <span class="mxinfo" id="T1:U1106"><span class="mxinfo" id="T1:U1107"><span class="var type1" id="S15T9U1302">qwp</span>(<span class="mxinfo" id="T1:U1109">1</span>)</span>*<span class="mxinfo" id="T1:U1110"><span class="var type1" id="S15T9U1305">qwp</span>(<span class="mxinfo" id="T1:U1112">3</span>)</span></span></span>)</span>*<span class="var type1" id="S23T1U1307">X</span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,112" id="srcline112">112</a></span><span class="line"><span class="mxinfo" id="T1:U1089"><span class="mxinfo" id="T1:U1091"><span class="mxinfo" id="T1:U1092"><span class="mxinfo" id="T1:U1093"><span class="mxinfo" id="T1:U1094">                <span class="mxinfo" id="T1:U1114"><span class="mxinfo" id="T1:U1115"><span class="mxinfo" id="T1:U1116">+ 2</span>*(<span class="mxinfo" id="T1:U1117"><span class="mxinfo" id="T1:U1118"><span class="mxinfo" id="T1:U1119"><span class="var type1" id="S15T9U1316">qwp</span>(<span class="mxinfo" id="T1:U1121">3</span>)</span>*<span class="mxinfo" id="T1:U1122"><span class="var type1" id="S15T9U1319">qwp</span>(<span class="mxinfo" id="T1:U1124">4</span>)</span></span> + <span class="mxinfo" id="T1:U1125"><span class="mxinfo" id="T1:U1126"><span class="var type1" id="S15T9U1323">qwp</span>(<span class="mxinfo" id="T1:U1128">1</span>)</span>*<span class="mxinfo" id="T1:U1129"><span class="var type1" id="S15T9U1326">qwp</span>(<span class="mxinfo" id="T1:U1131">2</span>)</span></span></span>)</span>*<span class="var type1" id="S24T1U1328">Y</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,113" id="srcline113">113</a></span><span class="line"><span class="mxinfo" id="T1:U1089"><span class="mxinfo" id="T1:U1091"><span class="mxinfo" id="T1:U1092"><span class="mxinfo" id="T1:U1093">                <span class="mxinfo" id="T1:U1133">+ (<span class="mxinfo" id="T1:U1134"><span class="mxinfo" id="T1:U1135"><span class="mxinfo" id="T1:U1136"><span class="mxinfo" id="T1:U1137"><span class="mxinfo" id="T1:U1138"><span class="var type1" id="S15T9U1337">qwp</span>(<span class="mxinfo" id="T1:U1140">1</span>)</span>^2</span>-<span class="mxinfo" id="T1:U1141"><span class="mxinfo" id="T1:U1142"><span class="var type1" id="S15T9U1342">qwp</span>(<span class="mxinfo" id="T1:U1144">2</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U1145"><span class="mxinfo" id="T1:U1146"><span class="var type1" id="S15T9U1347">qwp</span>(<span class="mxinfo" id="T1:U1148">3</span>)</span>^2</span></span>+<span class="mxinfo" id="T1:U1149"><span class="mxinfo" id="T1:U1150"><span class="var type1" id="S15T9U1352">qwp</span>(<span class="mxinfo" id="T1:U1152">4</span>)</span>^2</span></span>)*<span class="var type1" id="S25T1U1355">Z</span></span></span> + <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,114" id="srcline114">114</a></span><span class="line"><span class="mxinfo" id="T1:U1089"><span class="mxinfo" id="T1:U1091"><span class="mxinfo" id="T1:U1092">                + <span class="mxinfo" id="T1:U1154"><span class="var type1" id="S14T6U1358">Twp</span>(<span class="mxinfo" id="T1:U1156">3</span>)</span></span> - <span class="mxinfo" id="T1:U1157"><span class="mxinfo" id="T1:U1158"><span class="mxinfo" id="T6:U1159"><span class="mxinfo" id="T4:U1160"><span class="mxinfo" id="T53:U1161"><span class="var type1" id="S5T2U1365">z</span>(<span class="mxinfo" id="T1:U1163">1</span>,<span class="var type1" id="S8T1U1367">i</span>)</span>.cam_param</span>.translation_w2c</span>(<span class="mxinfo" id="T1:U1165">3</span>)</span>/<span class="mxinfo" id="T1:U1166">1000</span></span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m            </span></span></span>
<span class="srcline"><span class="lineno"><a href="77,115" id="srcline115">115</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,116" id="srcline116">116</a></span><span class="line">            <span class="mxinfo" id="T1:U1167"><span class="var type1" id="S29T1U1374">b</span> = <span class="mxinfo" id="T1:U1169"><span class="mxinfo" id="T1:U1170"><span class="mxinfo" id="T1:U1171"><span class="mxinfo" id="T1:U1172"><span class="var type1" id="S22T5U1379">K</span>(<span class="mxinfo" id="T1:U1174">3</span>,<span class="mxinfo" id="T1:U1175">1</span>)</span>*<span class="var type1" id="S26T1U1382">B1</span></span> + <span class="mxinfo" id="T1:U1177"><span class="mxinfo" id="T1:U1178"><span class="var type1" id="S22T5U1385">K</span>(<span class="mxinfo" id="T1:U1180">3</span>,<span class="mxinfo" id="T1:U1181">2</span>)</span>*<span class="var type1" id="S27T1U1388">B2</span></span></span> + <span class="mxinfo" id="T1:U1183"><span class="mxinfo" id="T1:U1184"><span class="var type1" id="S22T5U1391">K</span>(<span class="mxinfo" id="T1:U1186">3</span>,<span class="mxinfo" id="T1:U1187">3</span>)</span>*<span class="var type1" id="S28T1U1394">B3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,117" id="srcline117">117</a></span><span class="line">            <span class="mxinfo" id="T1:U1189"><span class="var type1" id="S30T1U1397">bu</span> = <span class="var type1" id="S29T1U1398">b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,118" id="srcline118">118</a></span><span class="line">            <span class="mxinfo" id="T1:U1192"><span class="var type1" id="S31T1U1401">bv</span> = <span class="var type1" id="S29T1U1402">b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,119" id="srcline119">119</a></span><span class="line">            <span class="mxinfo" id="T1:U1195"><span class="var type1" id="S32T1U1405">au</span> = <span class="mxinfo" id="T1:U1197"><span class="mxinfo" id="T1:U1198"><span class="mxinfo" id="T1:U1199"><span class="mxinfo" id="T1:U1200"><span class="var type1" id="S22T5U1410">K</span>(<span class="mxinfo" id="T1:U1202">1</span>,<span class="mxinfo" id="T1:U1203">1</span>)</span>*<span class="var type1" id="S26T1U1413">B1</span></span> + <span class="mxinfo" id="T1:U1205"><span class="mxinfo" id="T1:U1206"><span class="var type1" id="S22T5U1416">K</span>(<span class="mxinfo" id="T1:U1208">1</span>,<span class="mxinfo" id="T1:U1209">2</span>)</span>*<span class="var type1" id="S27T1U1419">B2</span></span></span> + <span class="mxinfo" id="T1:U1211"><span class="mxinfo" id="T1:U1212"><span class="var type1" id="S22T5U1422">K</span>(<span class="mxinfo" id="T1:U1214">1</span>,<span class="mxinfo" id="T1:U1215">3</span>)</span>*<span class="var type1" id="S28T1U1425">B3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,120" id="srcline120">120</a></span><span class="line">            <span class="mxinfo" id="T1:U1217"><span class="var type1" id="S33T1U1428">av</span> = <span class="mxinfo" id="T1:U1219"><span class="mxinfo" id="T1:U1220"><span class="mxinfo" id="T1:U1221"><span class="mxinfo" id="T1:U1222"><span class="var type1" id="S22T5U1433">K</span>(<span class="mxinfo" id="T1:U1224">2</span>,<span class="mxinfo" id="T1:U1225">1</span>)</span>*<span class="var type1" id="S26T1U1436">B1</span></span> + <span class="mxinfo" id="T1:U1227"><span class="mxinfo" id="T1:U1228"><span class="var type1" id="S22T5U1439">K</span>(<span class="mxinfo" id="T1:U1230">2</span>,<span class="mxinfo" id="T1:U1231">2</span>)</span>*<span class="var type1" id="S27T1U1442">B2</span></span></span> + <span class="mxinfo" id="T1:U1233"><span class="mxinfo" id="T1:U1234"><span class="var type1" id="S22T5U1445">K</span>(<span class="mxinfo" id="T1:U1236">2</span>,<span class="mxinfo" id="T1:U1237">3</span>)</span>*<span class="var type1" id="S28T1U1448">B3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,121" id="srcline121">121</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="77,122" id="srcline122">122</a></span><span class="line">            <span class="mxinfo" id="T18:U1239"><span class="var type1" id="S34T18U1451">dB1_q</span> = <span class="mxinfo" id="T18:U1241">[<span class="mxinfo" id="T1:U1242"><span class="mxinfo" id="T1:U1243">2</span>*(<span class="mxinfo" id="T1:U1244"><span class="mxinfo" id="T1:U1245"><span class="mxinfo" id="T1:U1246"><span class="mxinfo" id="T1:U1247"><span class="var type1" id="S15T9U1461">qwp</span>(<span class="mxinfo" id="T1:U1249">1</span>)</span>*<span class="var type1" id="S23T1U1463">X</span></span> - <span class="mxinfo" id="T1:U1251"><span class="mxinfo" id="T1:U1252"><span class="var type1" id="S15T9U1466">qwp</span>(<span class="mxinfo" id="T1:U1254">4</span>)</span>*<span class="var type1" id="S24T1U1468">Y</span></span></span> + <span class="mxinfo" id="T1:U1256"><span class="mxinfo" id="T1:U1257"><span class="var type1" id="S15T9U1471">qwp</span>(<span class="mxinfo" id="T1:U1259">3</span>)</span>*<span class="var type1" id="S25T1U1473">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U1261"><span class="mxinfo" id="T1:U1262">2</span>*(<span class="mxinfo" id="T1:U1263"><span class="mxinfo" id="T1:U1264"><span class="mxinfo" id="T1:U1265"><span class="mxinfo" id="T1:U1266"><span class="var type1" id="S15T9U1481">qwp</span>(<span class="mxinfo" id="T1:U1268">2</span>)</span>*<span class="var type1" id="S23T1U1483">X</span></span> + <span class="mxinfo" id="T1:U1270"><span class="mxinfo" id="T1:U1271"><span class="var type1" id="S15T9U1486">qwp</span>(<span class="mxinfo" id="T1:U1273">3</span>)</span>*<span class="var type1" id="S24T1U1488">Y</span></span></span> + <span class="mxinfo" id="T1:U1275"><span class="mxinfo" id="T1:U1276"><span class="var type1" id="S15T9U1491">qwp</span>(<span class="mxinfo" id="T1:U1278">4</span>)</span>*<span class="var type1" id="S25T1U1493">Z</span></span></span>)</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,123" id="srcline123">123</a></span><span class="line"><span class="mxinfo" id="T18:U1239"><span class="mxinfo" id="T18:U1241">                    <span class="mxinfo" id="T1:U1280"><span class="mxinfo" id="T1:U1281">2</span>*(<span class="mxinfo" id="T1:U1282"><span class="mxinfo" id="T1:U1283"><span class="mxinfo" id="T1:U1284"><span class="mxinfo" id="T1:U1285">-<span class="mxinfo" id="T1:U1286"><span class="var type1" id="S15T9U1502">qwp</span>(<span class="mxinfo" id="T1:U1288">3</span>)</span></span>*<span class="var type1" id="S23T1U1504">X</span></span> + <span class="mxinfo" id="T1:U1290"><span class="mxinfo" id="T1:U1291"><span class="var type1" id="S15T9U1507">qwp</span>(<span class="mxinfo" id="T1:U1293">2</span>)</span>*<span class="var type1" id="S24T1U1509">Y</span></span></span> + <span class="mxinfo" id="T1:U1295"><span class="mxinfo" id="T1:U1296"><span class="var type1" id="S15T9U1512">qwp</span>(<span class="mxinfo" id="T1:U1298">1</span>)</span>*<span class="var type1" id="S25T1U1514">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U1300"><span class="mxinfo" id="T1:U1301">2</span>*(<span class="mxinfo" id="T1:U1302"><span class="mxinfo" id="T1:U1303"><span class="mxinfo" id="T1:U1304"><span class="mxinfo" id="T1:U1305">-<span class="mxinfo" id="T1:U1306"><span class="var type1" id="S15T9U1523">qwp</span>(<span class="mxinfo" id="T1:U1308">4</span>)</span></span>*<span class="var type1" id="S23T1U1525">X</span></span> - <span class="mxinfo" id="T1:U1310"><span class="mxinfo" id="T1:U1311"><span class="var type1" id="S15T9U1528">qwp</span>(<span class="mxinfo" id="T1:U1313">1</span>)</span>*<span class="var type1" id="S24T1U1530">Y</span></span></span> + <span class="mxinfo" id="T1:U1315"><span class="mxinfo" id="T1:U1316"><span class="var type1" id="S15T9U1533">qwp</span>(<span class="mxinfo" id="T1:U1318">2</span>)</span>*<span class="var type1" id="S25T1U1535">Z</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,124" id="srcline124">124</a></span><span class="line">            <span class="mxinfo" id="T18:U1320"><span class="var type1" id="S35T18U1538">dB2_q</span> = <span class="mxinfo" id="T18:U1322">[<span class="mxinfo" id="T1:U1323"><span class="mxinfo" id="T1:U1324">2</span>*(<span class="mxinfo" id="T1:U1325"><span class="mxinfo" id="T1:U1326"><span class="mxinfo" id="T1:U1327"><span class="mxinfo" id="T1:U1328"><span class="var type1" id="S15T9U1548">qwp</span>(<span class="mxinfo" id="T1:U1330">4</span>)</span>*<span class="var type1" id="S23T1U1550">X</span></span> + <span class="mxinfo" id="T1:U1332"><span class="mxinfo" id="T1:U1333"><span class="var type1" id="S15T9U1553">qwp</span>(<span class="mxinfo" id="T1:U1335">1</span>)</span>*<span class="var type1" id="S24T1U1555">Y</span></span></span> - <span class="mxinfo" id="T1:U1337"><span class="mxinfo" id="T1:U1338"><span class="var type1" id="S15T9U1558">qwp</span>(<span class="mxinfo" id="T1:U1340">2</span>)</span>*<span class="var type1" id="S25T1U1560">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U1342"><span class="mxinfo" id="T1:U1343">2</span>*(<span class="mxinfo" id="T1:U1344"><span class="mxinfo" id="T1:U1345"><span class="mxinfo" id="T1:U1346"><span class="mxinfo" id="T1:U1347"><span class="var type1" id="S15T9U1568">qwp</span>(<span class="mxinfo" id="T1:U1349">3</span>)</span>*<span class="var type1" id="S23T1U1570">X</span></span> - <span class="mxinfo" id="T1:U1351"><span class="mxinfo" id="T1:U1352"><span class="var type1" id="S15T9U1573">qwp</span>(<span class="mxinfo" id="T1:U1354">2</span>)</span>*<span class="var type1" id="S24T1U1575">Y</span></span></span> - <span class="mxinfo" id="T1:U1356"><span class="mxinfo" id="T1:U1357"><span class="var type1" id="S15T9U1578">qwp</span>(<span class="mxinfo" id="T1:U1359">1</span>)</span>*<span class="var type1" id="S25T1U1580">Z</span></span></span>)</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,125" id="srcline125">125</a></span><span class="line"><span class="mxinfo" id="T18:U1320"><span class="mxinfo" id="T18:U1322">                    <span class="mxinfo" id="T1:U1361"><span class="mxinfo" id="T1:U1362">2</span>*(<span class="mxinfo" id="T1:U1363"><span class="mxinfo" id="T1:U1364"><span class="mxinfo" id="T1:U1365"><span class="mxinfo" id="T1:U1366"><span class="var type1" id="S15T9U1588">qwp</span>(<span class="mxinfo" id="T1:U1368">2</span>)</span>*<span class="var type1" id="S23T1U1590">X</span></span> + <span class="mxinfo" id="T1:U1370"><span class="mxinfo" id="T1:U1371"><span class="var type1" id="S15T9U1593">qwp</span>(<span class="mxinfo" id="T1:U1373">3</span>)</span>*<span class="var type1" id="S24T1U1595">Y</span></span></span> + <span class="mxinfo" id="T1:U1375"><span class="mxinfo" id="T1:U1376"><span class="var type1" id="S15T9U1598">qwp</span>(<span class="mxinfo" id="T1:U1378">4</span>)</span>*<span class="var type1" id="S25T1U1600">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U1380"><span class="mxinfo" id="T1:U1381">2</span>*(<span class="mxinfo" id="T1:U1382"><span class="mxinfo" id="T1:U1383"><span class="mxinfo" id="T1:U1384"><span class="mxinfo" id="T1:U1385"><span class="var type1" id="S15T9U1608">qwp</span>(<span class="mxinfo" id="T1:U1387">1</span>)</span>*<span class="var type1" id="S23T1U1610">X</span></span> - <span class="mxinfo" id="T1:U1389"><span class="mxinfo" id="T1:U1390"><span class="var type1" id="S15T9U1613">qwp</span>(<span class="mxinfo" id="T1:U1392">4</span>)</span>*<span class="var type1" id="S24T1U1615">Y</span></span></span> + <span class="mxinfo" id="T1:U1394"><span class="mxinfo" id="T1:U1395"><span class="var type1" id="S15T9U1618">qwp</span>(<span class="mxinfo" id="T1:U1397">3</span>)</span>*<span class="var type1" id="S25T1U1620">Z</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,126" id="srcline126">126</a></span><span class="line">            <span class="mxinfo" id="T18:U1399"><span class="var type1" id="S36T18U1623">dB3_q</span> = <span class="mxinfo" id="T18:U1401">[<span class="mxinfo" id="T1:U1402"><span class="mxinfo" id="T1:U1403">2</span>*(<span class="mxinfo" id="T1:U1404"><span class="mxinfo" id="T1:U1405"><span class="mxinfo" id="T1:U1406"><span class="mxinfo" id="T1:U1407">-<span class="mxinfo" id="T1:U1408"><span class="var type1" id="S15T9U1634">qwp</span>(<span class="mxinfo" id="T1:U1410">3</span>)</span></span>*<span class="var type1" id="S23T1U1636">X</span></span> + <span class="mxinfo" id="T1:U1412"><span class="mxinfo" id="T1:U1413"><span class="var type1" id="S15T9U1639">qwp</span>(<span class="mxinfo" id="T1:U1415">2</span>)</span>*<span class="var type1" id="S24T1U1641">Y</span></span></span> + <span class="mxinfo" id="T1:U1417"><span class="mxinfo" id="T1:U1418"><span class="var type1" id="S15T9U1644">qwp</span>(<span class="mxinfo" id="T1:U1420">1</span>)</span>*<span class="var type1" id="S25T1U1646">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U1422"><span class="mxinfo" id="T1:U1423">2</span>*(<span class="mxinfo" id="T1:U1424"><span class="mxinfo" id="T1:U1425"><span class="mxinfo" id="T1:U1426"><span class="mxinfo" id="T1:U1427"><span class="var type1" id="S15T9U1654">qwp</span>(<span class="mxinfo" id="T1:U1429">4</span>)</span>*<span class="var type1" id="S23T1U1656">X</span></span> + <span class="mxinfo" id="T1:U1431"><span class="mxinfo" id="T1:U1432"><span class="var type1" id="S15T9U1659">qwp</span>(<span class="mxinfo" id="T1:U1434">1</span>)</span>*<span class="var type1" id="S24T1U1661">Y</span></span></span> - <span class="mxinfo" id="T1:U1436"><span class="mxinfo" id="T1:U1437"><span class="var type1" id="S15T9U1664">qwp</span>(<span class="mxinfo" id="T1:U1439">2</span>)</span>*<span class="var type1" id="S25T1U1666">Z</span></span></span>)</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo" id="T18:U1399"><span class="mxinfo" id="T18:U1401">                    <span class="mxinfo" id="T1:U1441"><span class="mxinfo" id="T1:U1442">2</span>*(<span class="mxinfo" id="T1:U1443"><span class="mxinfo" id="T1:U1444"><span class="mxinfo" id="T1:U1445"><span class="mxinfo" id="T1:U1446">-<span class="mxinfo" id="T1:U1447"><span class="var type1" id="S15T9U1675">qwp</span>(<span class="mxinfo" id="T1:U1449">1</span>)</span></span>*<span class="var type1" id="S23T1U1677">X</span></span> + <span class="mxinfo" id="T1:U1451"><span class="mxinfo" id="T1:U1452"><span class="var type1" id="S15T9U1680">qwp</span>(<span class="mxinfo" id="T1:U1454">4</span>)</span>*<span class="var type1" id="S24T1U1682">Y</span></span></span> - <span class="mxinfo" id="T1:U1456"><span class="mxinfo" id="T1:U1457"><span class="var type1" id="S15T9U1685">qwp</span>(<span class="mxinfo" id="T1:U1459">3</span>)</span>*<span class="var type1" id="S25T1U1687">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U1461"><span class="mxinfo" id="T1:U1462">2</span>*(<span class="mxinfo" id="T1:U1463"><span class="mxinfo" id="T1:U1464"><span class="mxinfo" id="T1:U1465"><span class="mxinfo" id="T1:U1466"><span class="var type1" id="S15T9U1695">qwp</span>(<span class="mxinfo" id="T1:U1468">2</span>)</span>*<span class="var type1" id="S23T1U1697">X</span></span> + <span class="mxinfo" id="T1:U1470"><span class="mxinfo" id="T1:U1471"><span class="var type1" id="S15T9U1700">qwp</span>(<span class="mxinfo" id="T1:U1473">3</span>)</span>*<span class="var type1" id="S24T1U1702">Y</span></span></span> + <span class="mxinfo" id="T1:U1475"><span class="mxinfo" id="T1:U1476"><span class="var type1" id="S15T9U1705">qwp</span>(<span class="mxinfo" id="T1:U1478">4</span>)</span>*<span class="var type1" id="S25T1U1707">Z</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,128" id="srcline128">128</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,129" id="srcline129">129</a></span><span class="line">            <span class="mxinfo" id="T47:U1480"><span class="var type1" id="S37T47U1710">dB1_x</span> = <span class="mxinfo" id="T47:U1482">[<span class="mxinfo" id="T1:U1483">1</span> <span class="mxinfo" id="T1:U1484">0</span> <span class="mxinfo" id="T1:U1485">0</span> <span class="var type1" id="S34T18U1716">dB1_q</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,130" id="srcline130">130</a></span><span class="line">            <span class="mxinfo" id="T47:U1487"><span class="var type1" id="S38T47U1719">dB2_x</span> = <span class="mxinfo" id="T47:U1489">[<span class="mxinfo" id="T1:U1490">0</span> <span class="mxinfo" id="T1:U1491">1</span> <span class="mxinfo" id="T1:U1492">0</span> <span class="var type1" id="S35T18U1725">dB2_q</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,131" id="srcline131">131</a></span><span class="line">            <span class="mxinfo" id="T47:U1494"><span class="var type1" id="S39T47U1728">dB3_x</span> = <span class="mxinfo" id="T47:U1496">[<span class="mxinfo" id="T1:U1497">0</span> <span class="mxinfo" id="T1:U1498">0</span> <span class="mxinfo" id="T1:U1499">1</span> <span class="var type1" id="S36T18U1734">dB3_q</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,132" id="srcline132">132</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,133" id="srcline133">133</a></span><span class="line">            <span class="mxinfo" id="T47:U1501"><span class="var type1" id="S40T47U1737">au_prime</span> = <span class="mxinfo" id="T47:U1503"><span class="mxinfo" id="T47:U1504"><span class="mxinfo" id="T47:U1505"><span class="mxinfo" id="T1:U1506"><span class="var type1" id="S22T5U1742">K</span>(<span class="mxinfo" id="T1:U1508">1</span>,<span class="mxinfo" id="T1:U1509">1</span>)</span>*<span class="var type1" id="S37T47U1745">dB1_x</span></span> + <span class="mxinfo" id="T47:U1511"><span class="mxinfo" id="T1:U1512"><span class="var type1" id="S22T5U1748">K</span>(<span class="mxinfo" id="T1:U1514">1</span>,<span class="mxinfo" id="T1:U1515">2</span>)</span>*<span class="var type1" id="S38T47U1751">dB2_x</span></span></span> + <span class="mxinfo" id="T47:U1517"><span class="mxinfo" id="T1:U1518"><span class="var type1" id="S22T5U1754">K</span>(<span class="mxinfo" id="T1:U1520">1</span>,<span class="mxinfo" id="T1:U1521">3</span>)</span>*<span class="var type1" id="S39T47U1757">dB3_x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,134" id="srcline134">134</a></span><span class="line">            <span class="mxinfo" id="T47:U1523"><span class="var type1" id="S41T47U1760">av_prime</span> = <span class="mxinfo" id="T47:U1525"><span class="mxinfo" id="T47:U1526"><span class="mxinfo" id="T47:U1527"><span class="mxinfo" id="T1:U1528"><span class="var type1" id="S22T5U1765">K</span>(<span class="mxinfo" id="T1:U1530">2</span>,<span class="mxinfo" id="T1:U1531">1</span>)</span>*<span class="var type1" id="S37T47U1768">dB1_x</span></span> + <span class="mxinfo" id="T47:U1533"><span class="mxinfo" id="T1:U1534"><span class="var type1" id="S22T5U1771">K</span>(<span class="mxinfo" id="T1:U1536">2</span>,<span class="mxinfo" id="T1:U1537">2</span>)</span>*<span class="var type1" id="S38T47U1774">dB2_x</span></span></span> + <span class="mxinfo" id="T47:U1539"><span class="mxinfo" id="T1:U1540"><span class="var type1" id="S22T5U1777">K</span>(<span class="mxinfo" id="T1:U1542">2</span>,<span class="mxinfo" id="T1:U1543">3</span>)</span>*<span class="var type1" id="S39T47U1780">dB3_x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,135" id="srcline135">135</a></span><span class="line">            <span class="mxinfo" id="T47:U1545"><span class="var type1" id="S42T47U1783">b_prime</span> = <span class="mxinfo" id="T47:U1547"><span class="mxinfo" id="T47:U1548"><span class="mxinfo" id="T47:U1549"><span class="mxinfo" id="T1:U1550"><span class="var type1" id="S22T5U1788">K</span>(<span class="mxinfo" id="T1:U1552">3</span>,<span class="mxinfo" id="T1:U1553">1</span>)</span>*<span class="var type1" id="S37T47U1791">dB1_x</span></span> + <span class="mxinfo" id="T47:U1555"><span class="mxinfo" id="T1:U1556"><span class="var type1" id="S22T5U1794">K</span>(<span class="mxinfo" id="T1:U1558">3</span>,<span class="mxinfo" id="T1:U1559">2</span>)</span>*<span class="var type1" id="S38T47U1797">dB2_x</span></span></span> + <span class="mxinfo" id="T47:U1561"><span class="mxinfo" id="T1:U1562"><span class="var type1" id="S22T5U1800">K</span>(<span class="mxinfo" id="T1:U1564">3</span>,<span class="mxinfo" id="T1:U1565">3</span>)</span>*<span class="var type1" id="S39T47U1803">dB3_x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,136" id="srcline136">136</a></span><span class="line">            <span class="mxinfo" id="T47:U1567"><span class="var type1" id="S43T47U1806">bu_prime</span> = <span class="var type1" id="S42T47U1807">b_prime</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,137" id="srcline137">137</a></span><span class="line">            <span class="mxinfo" id="T47:U1570"><span class="var type1" id="S44T47U1810">bv_prime</span> = <span class="var type1" id="S42T47U1811">b_prime</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="77,138" id="srcline138">138</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,139" id="srcline139">139</a></span><span class="line">            <span class="mxinfo" id="T1:U1573"><span class="var type1" id="S45T1U1814">b_sq</span> = <span class="mxinfo" id="T1:U1575"><span class="var type1" id="S29T1U1816">b</span>^2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,140" id="srcline140">140</a></span><span class="line">            <span class="mxinfo" id="T47:U1577"><span class="var type1" id="S46T47U1820">du_dx</span> = <span class="mxinfo" id="T47:U1579">(<span class="mxinfo" id="T47:U1580"><span class="mxinfo" id="T47:U1581"><span class="var type1" id="S40T47U1825">au_prime</span>*<span class="var type1" id="S30T1U1826">bu</span></span> - <span class="mxinfo" id="T47:U1584"><span class="var type1" id="S32T1U1828">au</span>*<span class="var type1" id="S43T47U1829">bu_prime</span></span></span>)/<span class="var type1" id="S45T1U1830">b_sq</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,141" id="srcline141">141</a></span><span class="line">            <span class="mxinfo" id="T47:U1588"><span class="var type1" id="S47T47U1833">dv_dx</span> = <span class="mxinfo" id="T47:U1590">(<span class="mxinfo" id="T47:U1591"><span class="mxinfo" id="T47:U1592"><span class="var type1" id="S41T47U1838">av_prime</span>*<span class="var type1" id="S31T1U1839">bv</span></span> - <span class="mxinfo" id="T47:U1595"><span class="var type1" id="S33T1U1841">av</span>*<span class="var type1" id="S44T47U1842">bv_prime</span></span></span>)/<span class="var type1" id="S45T1U1843">b_sq</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,142" id="srcline142">142</a></span><span class="line">            <span class="mxinfo" id="T64:U1599"><span class="mxinfo" id="T64:U1600"><span class="var type1" id="S9T48U1847">A_lin</span>(<span class="mxinfo" id="T16:U1602"><span class="var type1" id="S16T1U1849">k</span>:<span class="mxinfo" id="T1:U1604"><span class="var type1" id="S16T1U1851">k</span>+1</span></span>,:)</span> = <span class="mxinfo" id="T64:U1606">[<span class="var type1" id="S46T47U1856">du_dx</span>;<span class="var type1" id="S47T47U1858">dv_dx</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,143" id="srcline143">143</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,144" id="srcline144">144</a></span><span class="line">            <span class="mxinfo" id="T1:U1609"><span class="mxinfo" id="T1:U1610"><span class="var type1" id="S13T34U1862">z_meas</span>(<span class="var type1" id="S16T1U1863">k</span>,<span class="mxinfo" id="T1:U1613">1</span>)</span> = <span class="mxinfo" id="T1:U1614"><span class="mxinfo" id="T3:U1615"><span class="mxinfo" id="T53:U1616"><span class="var type1" id="S5T2U1868">z</span>(<span class="mxinfo" id="T1:U1618">1</span>,<span class="var type1" id="S8T1U1870">i</span>)</span>.green_data</span>(<span class="mxinfo" id="T1:U1620">1</span>,<span class="mxinfo" id="T1:U1621">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,145" id="srcline145">145</a></span><span class="line">            <span class="mxinfo" id="T1:U1622"><span class="mxinfo" id="T1:U1623"><span class="var type1" id="S13T34U1877">z_meas</span>(<span class="mxinfo" id="T1:U1625"><span class="var type1" id="S16T1U1879">k</span>+<span class="mxinfo" id="T1:U1627">1</span></span>,<span class="mxinfo" id="T1:U1628">1</span>)</span> = <span class="mxinfo" id="T1:U1629"><span class="mxinfo" id="T3:U1630"><span class="mxinfo" id="T53:U1631"><span class="var type1" id="S5T2U1885">z</span>(<span class="mxinfo" id="T1:U1633">1</span>,<span class="var type1" id="S8T1U1887">i</span>)</span>.green_data</span>(<span class="mxinfo" id="T1:U1635">1</span>,<span class="mxinfo" id="T1:U1636">2</span>)</span></span>;            </span></span>
<span class="srcline"><span class="lineno"><a href="77,146" id="srcline146">146</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,147" id="srcline147">147</a></span><span class="line">            <span class="mxinfo" id="T1:U1637"><span class="var type1" id="S16T1U1893">k</span> = <span class="mxinfo" id="T1:U1639"><span class="var type1" id="S16T1U1895">k</span> + <span class="mxinfo" id="T1:U1641">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,148" id="srcline148">148</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,149" id="srcline149">149</a></span><span class="line">        <span class="comment">% blue blobs</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,150" id="srcline150">150</a></span><span class="line">        <span class="keyword">if</span> (<span class="mxinfo" id="T8:U1642"><span class="mxinfo" id="T1:U1643"><span class="mxinfo" id="T53:U1644"><span class="var type1" id="S5T2U1903">z</span>(<span class="mxinfo" id="T1:U1646">1</span>,<span class="var type1" id="S8T1U1905">i</span>)</span>.number_blue</span> == <span class="mxinfo" id="T1:U1648">1</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="77,151" id="srcline151">151</a></span><span class="line">            <span class="mxinfo" id="T16:U1649"><span class="var type1" id="S20T16U1910">u</span> = <span class="mxinfo" id="T16:U1651"><span class="fcn" id="F378N13:B1912">project2_2D</span>(<span class="var type1" id="S17T5U1913">A</span>,<span class="var type1" id="S18T5U1914">Rcw</span>,<span class="var type1" id="S19T6U1915">Tcw</span>,<span class="var type1" id="S14T6U1916">Twp</span>,<span class="var type1" id="S15T9U1917">qwp</span>,<span class="mxinfo" id="T6:U1657"><span class="mxinfo" id="T6:U1658"><span class="var type1" id="S6T5U1920">object_points</span>(:,<span class="mxinfo" id="T1:U1660">3</span>)</span>/<span class="mxinfo" id="T1:U1661">1000</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,152" id="srcline152">152</a></span><span class="line">            <span class="mxinfo" id="T16:U1662"><span class="mxinfo" id="T16:U1663"><span class="var type1" id="S12T34U1927">z_est</span>(<span class="mxinfo" id="T16:U1665"><span class="var type1" id="S16T1U1929">k</span>:<span class="mxinfo" id="T1:U1667"><span class="var type1" id="S16T1U1931">k</span>+1</span></span>,<span class="mxinfo" id="T1:U1669">1</span>)</span> = <span class="var type1" id="S20T16U1934">u</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,153" id="srcline153">153</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,154" id="srcline154">154</a></span><span class="line">            <span class="mxinfo" id="T5:U1671"><span class="var type1" id="S22T5U1937">K</span> = <span class="mxinfo" id="T5:U1673"><span class="var type1" id="S17T5U1939">A</span>*<span class="var type1" id="S18T5U1940">Rcw</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,155" id="srcline155">155</a></span><span class="line">            <span class="mxinfo" id="T1:U1676"><span class="var type1" id="S23T1U1943">X</span> = <span class="mxinfo" id="T1:U1678"><span class="mxinfo" id="T1:U1679"><span class="var type1" id="S6T5U1946">object_points</span>(<span class="mxinfo" id="T1:U1681">1</span>,<span class="mxinfo" id="T1:U1682">3</span>)</span>/<span class="mxinfo" id="T1:U1683">1000</span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,156" id="srcline156">156</a></span><span class="line">            <span class="mxinfo" id="T1:U1684"><span class="var type1" id="S24T1U1952">Y</span> = <span class="mxinfo" id="T1:U1686"><span class="mxinfo" id="T1:U1687"><span class="var type1" id="S6T5U1955">object_points</span>(<span class="mxinfo" id="T1:U1689">2</span>,<span class="mxinfo" id="T1:U1690">3</span>)</span>/<span class="mxinfo" id="T1:U1691">1000</span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,157" id="srcline157">157</a></span><span class="line">            <span class="mxinfo" id="T1:U1692"><span class="var type1" id="S25T1U1961">Z</span> = <span class="mxinfo" id="T1:U1694"><span class="mxinfo" id="T1:U1695"><span class="var type1" id="S6T5U1964">object_points</span>(<span class="mxinfo" id="T1:U1697">3</span>,<span class="mxinfo" id="T1:U1698">3</span>)</span>/<span class="mxinfo" id="T1:U1699">1000</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,158" id="srcline158">158</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="77,159" id="srcline159">159</a></span><span class="line">            <span class="comment">% calculate B's</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,160" id="srcline160">160</a></span><span class="line">            <span class="mxinfo" id="T1:U1700"><span class="var type1" id="S26T1U1970">B1</span> = <span class="mxinfo" id="T1:U1702"><span class="mxinfo" id="T1:U1703"><span class="mxinfo" id="T1:U1704"><span class="mxinfo" id="T1:U1705"><span class="mxinfo" id="T1:U1706">(<span class="mxinfo" id="T1:U1707"><span class="mxinfo" id="T1:U1708"><span class="mxinfo" id="T1:U1709"><span class="mxinfo" id="T1:U1710"><span class="mxinfo" id="T1:U1711"><span class="var type1" id="S15T9U1982">qwp</span>(<span class="mxinfo" id="T1:U1713">1</span>)</span>^2</span>+<span class="mxinfo" id="T1:U1714"><span class="mxinfo" id="T1:U1715"><span class="var type1" id="S15T9U1987">qwp</span>(<span class="mxinfo" id="T1:U1717">2</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U1718"><span class="mxinfo" id="T1:U1719"><span class="var type1" id="S15T9U1992">qwp</span>(<span class="mxinfo" id="T1:U1721">3</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U1722"><span class="mxinfo" id="T1:U1723"><span class="var type1" id="S15T9U1997">qwp</span>(<span class="mxinfo" id="T1:U1725">4</span>)</span>^2</span></span>)*<span class="var type1" id="S23T1U2000">X</span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo" id="T1:U1700"><span class="mxinfo" id="T1:U1702"><span class="mxinfo" id="T1:U1703"><span class="mxinfo" id="T1:U1704"><span class="mxinfo" id="T1:U1705">                <span class="mxinfo" id="T1:U1727"><span class="mxinfo" id="T1:U1728"><span class="mxinfo" id="T1:U1729">+ 2</span>*(<span class="mxinfo" id="T1:U1730"><span class="mxinfo" id="T1:U1731"><span class="mxinfo" id="T1:U1732"><span class="var type1" id="S15T9U2009">qwp</span>(<span class="mxinfo" id="T1:U1734">2</span>)</span>*<span class="mxinfo" id="T1:U1735"><span class="var type1" id="S15T9U2012">qwp</span>(<span class="mxinfo" id="T1:U1737">3</span>)</span></span> - <span class="mxinfo" id="T1:U1738"><span class="mxinfo" id="T1:U1739"><span class="var type1" id="S15T9U2016">qwp</span>(<span class="mxinfo" id="T1:U1741">1</span>)</span>*<span class="mxinfo" id="T1:U1742"><span class="var type1" id="S15T9U2019">qwp</span>(<span class="mxinfo" id="T1:U1744">4</span>)</span></span></span>)</span>*<span class="var type1" id="S24T1U2021">Y</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo" id="T1:U1700"><span class="mxinfo" id="T1:U1702"><span class="mxinfo" id="T1:U1703"><span class="mxinfo" id="T1:U1704">                <span class="mxinfo" id="T1:U1746"><span class="mxinfo" id="T1:U1747"><span class="mxinfo" id="T1:U1748">+ 2</span>*(<span class="mxinfo" id="T1:U1749"><span class="mxinfo" id="T1:U1750"><span class="mxinfo" id="T1:U1751"><span class="var type1" id="S15T9U2030">qwp</span>(<span class="mxinfo" id="T1:U1753">2</span>)</span>*<span class="mxinfo" id="T1:U1754"><span class="var type1" id="S15T9U2033">qwp</span>(<span class="mxinfo" id="T1:U1756">4</span>)</span></span> + <span class="mxinfo" id="T1:U1757"><span class="mxinfo" id="T1:U1758"><span class="var type1" id="S15T9U2037">qwp</span>(<span class="mxinfo" id="T1:U1760">1</span>)</span>*<span class="mxinfo" id="T1:U1761"><span class="var type1" id="S15T9U2040">qwp</span>(<span class="mxinfo" id="T1:U1763">3</span>)</span></span></span>)</span>*<span class="var type1" id="S25T1U2042">Z</span></span></span> + <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,163" id="srcline163">163</a></span><span class="line"><span class="mxinfo" id="T1:U1700"><span class="mxinfo" id="T1:U1702"><span class="mxinfo" id="T1:U1703">                + <span class="mxinfo" id="T1:U1765"><span class="var type1" id="S14T6U2045">Twp</span>(<span class="mxinfo" id="T1:U1767">1</span>)</span></span> - <span class="mxinfo" id="T1:U1768"><span class="mxinfo" id="T1:U1769"><span class="mxinfo" id="T6:U1770"><span class="mxinfo" id="T4:U1771"><span class="mxinfo" id="T53:U1772"><span class="var type1" id="S5T2U2052">z</span>(<span class="mxinfo" id="T1:U1774">1</span>,<span class="var type1" id="S8T1U2054">i</span>)</span>.cam_param</span>.translation_w2c</span>(<span class="mxinfo" id="T1:U1776">1</span>)</span>/<span class="mxinfo" id="T1:U1777">1000</span></span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,164" id="srcline164">164</a></span><span class="line">            <span class="mxinfo" id="T1:U1778"><span class="var type1" id="S27T1U2061">B2</span> = <span class="mxinfo" id="T1:U1780"><span class="mxinfo" id="T1:U1781"><span class="mxinfo" id="T1:U1782"><span class="mxinfo" id="T1:U1783"><span class="mxinfo" id="T1:U1784"><span class="mxinfo" id="T1:U1785"><span class="mxinfo" id="T1:U1786">2</span>*(<span class="mxinfo" id="T1:U1787"><span class="mxinfo" id="T1:U1788"><span class="mxinfo" id="T1:U1789"><span class="var type1" id="S15T9U2073">qwp</span>(<span class="mxinfo" id="T1:U1791">2</span>)</span>*<span class="mxinfo" id="T1:U1792"><span class="var type1" id="S15T9U2076">qwp</span>(<span class="mxinfo" id="T1:U1794">3</span>)</span></span> + <span class="mxinfo" id="T1:U1795"><span class="mxinfo" id="T1:U1796"><span class="var type1" id="S15T9U2080">qwp</span>(<span class="mxinfo" id="T1:U1798">1</span>)</span>*<span class="mxinfo" id="T1:U1799"><span class="var type1" id="S15T9U2083">qwp</span>(<span class="mxinfo" id="T1:U1801">4</span>)</span></span></span>)</span>*<span class="var type1" id="S23T1U2085">X</span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,165" id="srcline165">165</a></span><span class="line"><span class="mxinfo" id="T1:U1778"><span class="mxinfo" id="T1:U1780"><span class="mxinfo" id="T1:U1781"><span class="mxinfo" id="T1:U1782"><span class="mxinfo" id="T1:U1783">                <span class="mxinfo" id="T1:U1803">+ (<span class="mxinfo" id="T1:U1804"><span class="mxinfo" id="T1:U1805"><span class="mxinfo" id="T1:U1806"><span class="mxinfo" id="T1:U1807"><span class="mxinfo" id="T1:U1808"><span class="var type1" id="S15T9U2094">qwp</span>(<span class="mxinfo" id="T1:U1810">1</span>)</span>^2</span>-<span class="mxinfo" id="T1:U1811"><span class="mxinfo" id="T1:U1812"><span class="var type1" id="S15T9U2099">qwp</span>(<span class="mxinfo" id="T1:U1814">2</span>)</span>^2</span></span>+<span class="mxinfo" id="T1:U1815"><span class="mxinfo" id="T1:U1816"><span class="var type1" id="S15T9U2104">qwp</span>(<span class="mxinfo" id="T1:U1818">3</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U1819"><span class="mxinfo" id="T1:U1820"><span class="var type1" id="S15T9U2109">qwp</span>(<span class="mxinfo" id="T1:U1822">4</span>)</span>^2</span></span>)*<span class="var type1" id="S24T1U2112">Y</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,166" id="srcline166">166</a></span><span class="line"><span class="mxinfo" id="T1:U1778"><span class="mxinfo" id="T1:U1780"><span class="mxinfo" id="T1:U1781"><span class="mxinfo" id="T1:U1782">                <span class="mxinfo" id="T1:U1824"><span class="mxinfo" id="T1:U1825"><span class="mxinfo" id="T1:U1826">+ 2</span>*(<span class="mxinfo" id="T1:U1827"><span class="mxinfo" id="T1:U1828"><span class="mxinfo" id="T1:U1829"><span class="var type1" id="S15T9U2121">qwp</span>(<span class="mxinfo" id="T1:U1831">3</span>)</span>*<span class="mxinfo" id="T1:U1832"><span class="var type1" id="S15T9U2124">qwp</span>(<span class="mxinfo" id="T1:U1834">4</span>)</span></span> - <span class="mxinfo" id="T1:U1835"><span class="mxinfo" id="T1:U1836"><span class="var type1" id="S15T9U2128">qwp</span>(<span class="mxinfo" id="T1:U1838">1</span>)</span>*<span class="mxinfo" id="T1:U1839"><span class="var type1" id="S15T9U2131">qwp</span>(<span class="mxinfo" id="T1:U1841">2</span>)</span></span></span>)</span>*<span class="var type1" id="S25T1U2133">Z</span></span></span> + <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,167" id="srcline167">167</a></span><span class="line"><span class="mxinfo" id="T1:U1778"><span class="mxinfo" id="T1:U1780"><span class="mxinfo" id="T1:U1781">                + <span class="mxinfo" id="T1:U1843"><span class="var type1" id="S14T6U2136">Twp</span>(<span class="mxinfo" id="T1:U1845">2</span>)</span></span> - <span class="mxinfo" id="T1:U1846"><span class="mxinfo" id="T1:U1847"><span class="mxinfo" id="T6:U1848"><span class="mxinfo" id="T4:U1849"><span class="mxinfo" id="T53:U1850"><span class="var type1" id="S5T2U2143">z</span>(<span class="mxinfo" id="T1:U1852">1</span>,<span class="var type1" id="S8T1U2145">i</span>)</span>.cam_param</span>.translation_w2c</span>(<span class="mxinfo" id="T1:U1854">2</span>)</span>/<span class="mxinfo" id="T1:U1855">1000</span></span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,168" id="srcline168">168</a></span><span class="line">            <span class="mxinfo" id="T1:U1856"><span class="var type1" id="S28T1U2152">B3</span> = <span class="mxinfo" id="T1:U1858"><span class="mxinfo" id="T1:U1859"><span class="mxinfo" id="T1:U1860"><span class="mxinfo" id="T1:U1861"><span class="mxinfo" id="T1:U1862"><span class="mxinfo" id="T1:U1863"><span class="mxinfo" id="T1:U1864">2</span>*(<span class="mxinfo" id="T1:U1865"><span class="mxinfo" id="T1:U1866"><span class="mxinfo" id="T1:U1867"><span class="var type1" id="S15T9U2164">qwp</span>(<span class="mxinfo" id="T1:U1869">2</span>)</span>*<span class="mxinfo" id="T1:U1870"><span class="var type1" id="S15T9U2167">qwp</span>(<span class="mxinfo" id="T1:U1872">4</span>)</span></span> - <span class="mxinfo" id="T1:U1873"><span class="mxinfo" id="T1:U1874"><span class="var type1" id="S15T9U2171">qwp</span>(<span class="mxinfo" id="T1:U1876">1</span>)</span>*<span class="mxinfo" id="T1:U1877"><span class="var type1" id="S15T9U2174">qwp</span>(<span class="mxinfo" id="T1:U1879">3</span>)</span></span></span>)</span>*<span class="var type1" id="S23T1U2176">X</span></span> + <span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,169" id="srcline169">169</a></span><span class="line"><span class="mxinfo" id="T1:U1856"><span class="mxinfo" id="T1:U1858"><span class="mxinfo" id="T1:U1859"><span class="mxinfo" id="T1:U1860"><span class="mxinfo" id="T1:U1861">                <span class="mxinfo" id="T1:U1881"><span class="mxinfo" id="T1:U1882"><span class="mxinfo" id="T1:U1883">+ 2</span>*(<span class="mxinfo" id="T1:U1884"><span class="mxinfo" id="T1:U1885"><span class="mxinfo" id="T1:U1886"><span class="var type1" id="S15T9U2185">qwp</span>(<span class="mxinfo" id="T1:U1888">3</span>)</span>*<span class="mxinfo" id="T1:U1889"><span class="var type1" id="S15T9U2188">qwp</span>(<span class="mxinfo" id="T1:U1891">4</span>)</span></span> + <span class="mxinfo" id="T1:U1892"><span class="mxinfo" id="T1:U1893"><span class="var type1" id="S15T9U2192">qwp</span>(<span class="mxinfo" id="T1:U1895">1</span>)</span>*<span class="mxinfo" id="T1:U1896"><span class="var type1" id="S15T9U2195">qwp</span>(<span class="mxinfo" id="T1:U1898">2</span>)</span></span></span>)</span>*<span class="var type1" id="S24T1U2197">Y</span></span></span> + <span class="keyword">...</span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,170" id="srcline170">170</a></span><span class="line"><span class="mxinfo" id="T1:U1856"><span class="mxinfo" id="T1:U1858"><span class="mxinfo" id="T1:U1859"><span class="mxinfo" id="T1:U1860">                <span class="mxinfo" id="T1:U1900">+ (<span class="mxinfo" id="T1:U1901"><span class="mxinfo" id="T1:U1902"><span class="mxinfo" id="T1:U1903"><span class="mxinfo" id="T1:U1904"><span class="mxinfo" id="T1:U1905"><span class="var type1" id="S15T9U2206">qwp</span>(<span class="mxinfo" id="T1:U1907">1</span>)</span>^2</span>-<span class="mxinfo" id="T1:U1908"><span class="mxinfo" id="T1:U1909"><span class="var type1" id="S15T9U2211">qwp</span>(<span class="mxinfo" id="T1:U1911">2</span>)</span>^2</span></span>-<span class="mxinfo" id="T1:U1912"><span class="mxinfo" id="T1:U1913"><span class="var type1" id="S15T9U2216">qwp</span>(<span class="mxinfo" id="T1:U1915">3</span>)</span>^2</span></span>+<span class="mxinfo" id="T1:U1916"><span class="mxinfo" id="T1:U1917"><span class="var type1" id="S15T9U2221">qwp</span>(<span class="mxinfo" id="T1:U1919">4</span>)</span>^2</span></span>)*<span class="var type1" id="S25T1U2224">Z</span></span></span> + <span class="keyword">...</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,171" id="srcline171">171</a></span><span class="line"><span class="mxinfo" id="T1:U1856"><span class="mxinfo" id="T1:U1858"><span class="mxinfo" id="T1:U1859">                + <span class="mxinfo" id="T1:U1921"><span class="var type1" id="S14T6U2227">Twp</span>(<span class="mxinfo" id="T1:U1923">3</span>)</span></span> - <span class="mxinfo" id="T1:U1924"><span class="mxinfo" id="T1:U1925"><span class="mxinfo" id="T6:U1926"><span class="mxinfo" id="T4:U1927"><span class="mxinfo" id="T53:U1928"><span class="var type1" id="S5T2U2234">z</span>(<span class="mxinfo" id="T1:U1930">1</span>,<span class="var type1" id="S8T1U2236">i</span>)</span>.cam_param</span>.translation_w2c</span>(<span class="mxinfo" id="T1:U1932">3</span>)</span>/<span class="mxinfo" id="T1:U1933">1000</span></span></span></span>; <span class="comment">% convert mapping from pixel/mm to pixel/m            </span></span></span>
<span class="srcline"><span class="lineno"><a href="77,172" id="srcline172">172</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,173" id="srcline173">173</a></span><span class="line">            <span class="mxinfo" id="T1:U1934"><span class="var type1" id="S29T1U2243">b</span> = <span class="mxinfo" id="T1:U1936"><span class="mxinfo" id="T1:U1937"><span class="mxinfo" id="T1:U1938"><span class="mxinfo" id="T1:U1939"><span class="var type1" id="S22T5U2248">K</span>(<span class="mxinfo" id="T1:U1941">3</span>,<span class="mxinfo" id="T1:U1942">1</span>)</span>*<span class="var type1" id="S26T1U2251">B1</span></span> + <span class="mxinfo" id="T1:U1944"><span class="mxinfo" id="T1:U1945"><span class="var type1" id="S22T5U2254">K</span>(<span class="mxinfo" id="T1:U1947">3</span>,<span class="mxinfo" id="T1:U1948">2</span>)</span>*<span class="var type1" id="S27T1U2257">B2</span></span></span> + <span class="mxinfo" id="T1:U1950"><span class="mxinfo" id="T1:U1951"><span class="var type1" id="S22T5U2260">K</span>(<span class="mxinfo" id="T1:U1953">3</span>,<span class="mxinfo" id="T1:U1954">3</span>)</span>*<span class="var type1" id="S28T1U2263">B3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,174" id="srcline174">174</a></span><span class="line">            <span class="mxinfo" id="T1:U1956"><span class="var type1" id="S30T1U2266">bu</span> = <span class="var type1" id="S29T1U2267">b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,175" id="srcline175">175</a></span><span class="line">            <span class="mxinfo" id="T1:U1959"><span class="var type1" id="S31T1U2270">bv</span> = <span class="var type1" id="S29T1U2271">b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,176" id="srcline176">176</a></span><span class="line">            <span class="mxinfo" id="T1:U1962"><span class="var type1" id="S32T1U2274">au</span> = <span class="mxinfo" id="T1:U1964"><span class="mxinfo" id="T1:U1965"><span class="mxinfo" id="T1:U1966"><span class="mxinfo" id="T1:U1967"><span class="var type1" id="S22T5U2279">K</span>(<span class="mxinfo" id="T1:U1969">1</span>,<span class="mxinfo" id="T1:U1970">1</span>)</span>*<span class="var type1" id="S26T1U2282">B1</span></span> + <span class="mxinfo" id="T1:U1972"><span class="mxinfo" id="T1:U1973"><span class="var type1" id="S22T5U2285">K</span>(<span class="mxinfo" id="T1:U1975">1</span>,<span class="mxinfo" id="T1:U1976">2</span>)</span>*<span class="var type1" id="S27T1U2288">B2</span></span></span> + <span class="mxinfo" id="T1:U1978"><span class="mxinfo" id="T1:U1979"><span class="var type1" id="S22T5U2291">K</span>(<span class="mxinfo" id="T1:U1981">1</span>,<span class="mxinfo" id="T1:U1982">3</span>)</span>*<span class="var type1" id="S28T1U2294">B3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,177" id="srcline177">177</a></span><span class="line">            <span class="mxinfo" id="T1:U1984"><span class="var type1" id="S33T1U2297">av</span> = <span class="mxinfo" id="T1:U1986"><span class="mxinfo" id="T1:U1987"><span class="mxinfo" id="T1:U1988"><span class="mxinfo" id="T1:U1989"><span class="var type1" id="S22T5U2302">K</span>(<span class="mxinfo" id="T1:U1991">2</span>,<span class="mxinfo" id="T1:U1992">1</span>)</span>*<span class="var type1" id="S26T1U2305">B1</span></span> + <span class="mxinfo" id="T1:U1994"><span class="mxinfo" id="T1:U1995"><span class="var type1" id="S22T5U2308">K</span>(<span class="mxinfo" id="T1:U1997">2</span>,<span class="mxinfo" id="T1:U1998">2</span>)</span>*<span class="var type1" id="S27T1U2311">B2</span></span></span> + <span class="mxinfo" id="T1:U2000"><span class="mxinfo" id="T1:U2001"><span class="var type1" id="S22T5U2314">K</span>(<span class="mxinfo" id="T1:U2003">2</span>,<span class="mxinfo" id="T1:U2004">3</span>)</span>*<span class="var type1" id="S28T1U2317">B3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,178" id="srcline178">178</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="77,179" id="srcline179">179</a></span><span class="line">            <span class="mxinfo" id="T18:U2006"><span class="var type1" id="S34T18U2320">dB1_q</span> = <span class="mxinfo" id="T18:U2008">[<span class="mxinfo" id="T1:U2009"><span class="mxinfo" id="T1:U2010">2</span>*(<span class="mxinfo" id="T1:U2011"><span class="mxinfo" id="T1:U2012"><span class="mxinfo" id="T1:U2013"><span class="mxinfo" id="T1:U2014"><span class="var type1" id="S15T9U2330">qwp</span>(<span class="mxinfo" id="T1:U2016">1</span>)</span>*<span class="var type1" id="S23T1U2332">X</span></span> - <span class="mxinfo" id="T1:U2018"><span class="mxinfo" id="T1:U2019"><span class="var type1" id="S15T9U2335">qwp</span>(<span class="mxinfo" id="T1:U2021">4</span>)</span>*<span class="var type1" id="S24T1U2337">Y</span></span></span> + <span class="mxinfo" id="T1:U2023"><span class="mxinfo" id="T1:U2024"><span class="var type1" id="S15T9U2340">qwp</span>(<span class="mxinfo" id="T1:U2026">3</span>)</span>*<span class="var type1" id="S25T1U2342">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U2028"><span class="mxinfo" id="T1:U2029">2</span>*(<span class="mxinfo" id="T1:U2030"><span class="mxinfo" id="T1:U2031"><span class="mxinfo" id="T1:U2032"><span class="mxinfo" id="T1:U2033"><span class="var type1" id="S15T9U2350">qwp</span>(<span class="mxinfo" id="T1:U2035">2</span>)</span>*<span class="var type1" id="S23T1U2352">X</span></span> + <span class="mxinfo" id="T1:U2037"><span class="mxinfo" id="T1:U2038"><span class="var type1" id="S15T9U2355">qwp</span>(<span class="mxinfo" id="T1:U2040">3</span>)</span>*<span class="var type1" id="S24T1U2357">Y</span></span></span> + <span class="mxinfo" id="T1:U2042"><span class="mxinfo" id="T1:U2043"><span class="var type1" id="S15T9U2360">qwp</span>(<span class="mxinfo" id="T1:U2045">4</span>)</span>*<span class="var type1" id="S25T1U2362">Z</span></span></span>)</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo" id="T18:U2006"><span class="mxinfo" id="T18:U2008">                    <span class="mxinfo" id="T1:U2047"><span class="mxinfo" id="T1:U2048">2</span>*(<span class="mxinfo" id="T1:U2049"><span class="mxinfo" id="T1:U2050"><span class="mxinfo" id="T1:U2051"><span class="mxinfo" id="T1:U2052">-<span class="mxinfo" id="T1:U2053"><span class="var type1" id="S15T9U2371">qwp</span>(<span class="mxinfo" id="T1:U2055">3</span>)</span></span>*<span class="var type1" id="S23T1U2373">X</span></span> + <span class="mxinfo" id="T1:U2057"><span class="mxinfo" id="T1:U2058"><span class="var type1" id="S15T9U2376">qwp</span>(<span class="mxinfo" id="T1:U2060">2</span>)</span>*<span class="var type1" id="S24T1U2378">Y</span></span></span> + <span class="mxinfo" id="T1:U2062"><span class="mxinfo" id="T1:U2063"><span class="var type1" id="S15T9U2381">qwp</span>(<span class="mxinfo" id="T1:U2065">1</span>)</span>*<span class="var type1" id="S25T1U2383">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U2067"><span class="mxinfo" id="T1:U2068">2</span>*(<span class="mxinfo" id="T1:U2069"><span class="mxinfo" id="T1:U2070"><span class="mxinfo" id="T1:U2071"><span class="mxinfo" id="T1:U2072">-<span class="mxinfo" id="T1:U2073"><span class="var type1" id="S15T9U2392">qwp</span>(<span class="mxinfo" id="T1:U2075">4</span>)</span></span>*<span class="var type1" id="S23T1U2394">X</span></span> - <span class="mxinfo" id="T1:U2077"><span class="mxinfo" id="T1:U2078"><span class="var type1" id="S15T9U2397">qwp</span>(<span class="mxinfo" id="T1:U2080">1</span>)</span>*<span class="var type1" id="S24T1U2399">Y</span></span></span> + <span class="mxinfo" id="T1:U2082"><span class="mxinfo" id="T1:U2083"><span class="var type1" id="S15T9U2402">qwp</span>(<span class="mxinfo" id="T1:U2085">2</span>)</span>*<span class="var type1" id="S25T1U2404">Z</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,181" id="srcline181">181</a></span><span class="line">            <span class="mxinfo" id="T18:U2087"><span class="var type1" id="S35T18U2407">dB2_q</span> = <span class="mxinfo" id="T18:U2089">[<span class="mxinfo" id="T1:U2090"><span class="mxinfo" id="T1:U2091">2</span>*(<span class="mxinfo" id="T1:U2092"><span class="mxinfo" id="T1:U2093"><span class="mxinfo" id="T1:U2094"><span class="mxinfo" id="T1:U2095"><span class="var type1" id="S15T9U2417">qwp</span>(<span class="mxinfo" id="T1:U2097">4</span>)</span>*<span class="var type1" id="S23T1U2419">X</span></span> + <span class="mxinfo" id="T1:U2099"><span class="mxinfo" id="T1:U2100"><span class="var type1" id="S15T9U2422">qwp</span>(<span class="mxinfo" id="T1:U2102">1</span>)</span>*<span class="var type1" id="S24T1U2424">Y</span></span></span> - <span class="mxinfo" id="T1:U2104"><span class="mxinfo" id="T1:U2105"><span class="var type1" id="S15T9U2427">qwp</span>(<span class="mxinfo" id="T1:U2107">2</span>)</span>*<span class="var type1" id="S25T1U2429">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U2109"><span class="mxinfo" id="T1:U2110">2</span>*(<span class="mxinfo" id="T1:U2111"><span class="mxinfo" id="T1:U2112"><span class="mxinfo" id="T1:U2113"><span class="mxinfo" id="T1:U2114"><span class="var type1" id="S15T9U2437">qwp</span>(<span class="mxinfo" id="T1:U2116">3</span>)</span>*<span class="var type1" id="S23T1U2439">X</span></span> - <span class="mxinfo" id="T1:U2118"><span class="mxinfo" id="T1:U2119"><span class="var type1" id="S15T9U2442">qwp</span>(<span class="mxinfo" id="T1:U2121">2</span>)</span>*<span class="var type1" id="S24T1U2444">Y</span></span></span> - <span class="mxinfo" id="T1:U2123"><span class="mxinfo" id="T1:U2124"><span class="var type1" id="S15T9U2447">qwp</span>(<span class="mxinfo" id="T1:U2126">1</span>)</span>*<span class="var type1" id="S25T1U2449">Z</span></span></span>)</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo" id="T18:U2087"><span class="mxinfo" id="T18:U2089">                    <span class="mxinfo" id="T1:U2128"><span class="mxinfo" id="T1:U2129">2</span>*(<span class="mxinfo" id="T1:U2130"><span class="mxinfo" id="T1:U2131"><span class="mxinfo" id="T1:U2132"><span class="mxinfo" id="T1:U2133"><span class="var type1" id="S15T9U2457">qwp</span>(<span class="mxinfo" id="T1:U2135">2</span>)</span>*<span class="var type1" id="S23T1U2459">X</span></span> + <span class="mxinfo" id="T1:U2137"><span class="mxinfo" id="T1:U2138"><span class="var type1" id="S15T9U2462">qwp</span>(<span class="mxinfo" id="T1:U2140">3</span>)</span>*<span class="var type1" id="S24T1U2464">Y</span></span></span> + <span class="mxinfo" id="T1:U2142"><span class="mxinfo" id="T1:U2143"><span class="var type1" id="S15T9U2467">qwp</span>(<span class="mxinfo" id="T1:U2145">4</span>)</span>*<span class="var type1" id="S25T1U2469">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U2147"><span class="mxinfo" id="T1:U2148">2</span>*(<span class="mxinfo" id="T1:U2149"><span class="mxinfo" id="T1:U2150"><span class="mxinfo" id="T1:U2151"><span class="mxinfo" id="T1:U2152"><span class="var type1" id="S15T9U2477">qwp</span>(<span class="mxinfo" id="T1:U2154">1</span>)</span>*<span class="var type1" id="S23T1U2479">X</span></span> - <span class="mxinfo" id="T1:U2156"><span class="mxinfo" id="T1:U2157"><span class="var type1" id="S15T9U2482">qwp</span>(<span class="mxinfo" id="T1:U2159">4</span>)</span>*<span class="var type1" id="S24T1U2484">Y</span></span></span> + <span class="mxinfo" id="T1:U2161"><span class="mxinfo" id="T1:U2162"><span class="var type1" id="S15T9U2487">qwp</span>(<span class="mxinfo" id="T1:U2164">3</span>)</span>*<span class="var type1" id="S25T1U2489">Z</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,183" id="srcline183">183</a></span><span class="line">            <span class="mxinfo" id="T18:U2166"><span class="var type1" id="S36T18U2492">dB3_q</span> = <span class="mxinfo" id="T18:U2168">[<span class="mxinfo" id="T1:U2169"><span class="mxinfo" id="T1:U2170">2</span>*(<span class="mxinfo" id="T1:U2171"><span class="mxinfo" id="T1:U2172"><span class="mxinfo" id="T1:U2173"><span class="mxinfo" id="T1:U2174">-<span class="mxinfo" id="T1:U2175"><span class="var type1" id="S15T9U2503">qwp</span>(<span class="mxinfo" id="T1:U2177">3</span>)</span></span>*<span class="var type1" id="S23T1U2505">X</span></span> + <span class="mxinfo" id="T1:U2179"><span class="mxinfo" id="T1:U2180"><span class="var type1" id="S15T9U2508">qwp</span>(<span class="mxinfo" id="T1:U2182">2</span>)</span>*<span class="var type1" id="S24T1U2510">Y</span></span></span> + <span class="mxinfo" id="T1:U2184"><span class="mxinfo" id="T1:U2185"><span class="var type1" id="S15T9U2513">qwp</span>(<span class="mxinfo" id="T1:U2187">1</span>)</span>*<span class="var type1" id="S25T1U2515">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U2189"><span class="mxinfo" id="T1:U2190">2</span>*(<span class="mxinfo" id="T1:U2191"><span class="mxinfo" id="T1:U2192"><span class="mxinfo" id="T1:U2193"><span class="mxinfo" id="T1:U2194"><span class="var type1" id="S15T9U2523">qwp</span>(<span class="mxinfo" id="T1:U2196">4</span>)</span>*<span class="var type1" id="S23T1U2525">X</span></span> + <span class="mxinfo" id="T1:U2198"><span class="mxinfo" id="T1:U2199"><span class="var type1" id="S15T9U2528">qwp</span>(<span class="mxinfo" id="T1:U2201">1</span>)</span>*<span class="var type1" id="S24T1U2530">Y</span></span></span> - <span class="mxinfo" id="T1:U2203"><span class="mxinfo" id="T1:U2204"><span class="var type1" id="S15T9U2533">qwp</span>(<span class="mxinfo" id="T1:U2206">2</span>)</span>*<span class="var type1" id="S25T1U2535">Z</span></span></span>)</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="77,184" id="srcline184">184</a></span><span class="line"><span class="mxinfo" id="T18:U2166"><span class="mxinfo" id="T18:U2168">                    <span class="mxinfo" id="T1:U2208"><span class="mxinfo" id="T1:U2209">2</span>*(<span class="mxinfo" id="T1:U2210"><span class="mxinfo" id="T1:U2211"><span class="mxinfo" id="T1:U2212"><span class="mxinfo" id="T1:U2213">-<span class="mxinfo" id="T1:U2214"><span class="var type1" id="S15T9U2544">qwp</span>(<span class="mxinfo" id="T1:U2216">1</span>)</span></span>*<span class="var type1" id="S23T1U2546">X</span></span> + <span class="mxinfo" id="T1:U2218"><span class="mxinfo" id="T1:U2219"><span class="var type1" id="S15T9U2549">qwp</span>(<span class="mxinfo" id="T1:U2221">4</span>)</span>*<span class="var type1" id="S24T1U2551">Y</span></span></span> - <span class="mxinfo" id="T1:U2223"><span class="mxinfo" id="T1:U2224"><span class="var type1" id="S15T9U2554">qwp</span>(<span class="mxinfo" id="T1:U2226">3</span>)</span>*<span class="var type1" id="S25T1U2556">Z</span></span></span>)</span>,<span class="mxinfo" id="T1:U2228"><span class="mxinfo" id="T1:U2229">2</span>*(<span class="mxinfo" id="T1:U2230"><span class="mxinfo" id="T1:U2231"><span class="mxinfo" id="T1:U2232"><span class="mxinfo" id="T1:U2233"><span class="var type1" id="S15T9U2564">qwp</span>(<span class="mxinfo" id="T1:U2235">2</span>)</span>*<span class="var type1" id="S23T1U2566">X</span></span> + <span class="mxinfo" id="T1:U2237"><span class="mxinfo" id="T1:U2238"><span class="var type1" id="S15T9U2569">qwp</span>(<span class="mxinfo" id="T1:U2240">3</span>)</span>*<span class="var type1" id="S24T1U2571">Y</span></span></span> + <span class="mxinfo" id="T1:U2242"><span class="mxinfo" id="T1:U2243"><span class="var type1" id="S15T9U2574">qwp</span>(<span class="mxinfo" id="T1:U2245">4</span>)</span>*<span class="var type1" id="S25T1U2576">Z</span></span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,185" id="srcline185">185</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,186" id="srcline186">186</a></span><span class="line">            <span class="mxinfo" id="T47:U2247"><span class="var type1" id="S37T47U2579">dB1_x</span> = <span class="mxinfo" id="T47:U2249">[<span class="mxinfo" id="T1:U2250">1</span> <span class="mxinfo" id="T1:U2251">0</span> <span class="mxinfo" id="T1:U2252">0</span> <span class="var type1" id="S34T18U2585">dB1_q</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,187" id="srcline187">187</a></span><span class="line">            <span class="mxinfo" id="T47:U2254"><span class="var type1" id="S38T47U2588">dB2_x</span> = <span class="mxinfo" id="T47:U2256">[<span class="mxinfo" id="T1:U2257">0</span> <span class="mxinfo" id="T1:U2258">1</span> <span class="mxinfo" id="T1:U2259">0</span> <span class="var type1" id="S35T18U2594">dB2_q</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,188" id="srcline188">188</a></span><span class="line">            <span class="mxinfo" id="T47:U2261"><span class="var type1" id="S39T47U2597">dB3_x</span> = <span class="mxinfo" id="T47:U2263">[<span class="mxinfo" id="T1:U2264">0</span> <span class="mxinfo" id="T1:U2265">0</span> <span class="mxinfo" id="T1:U2266">1</span> <span class="var type1" id="S36T18U2603">dB3_q</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,189" id="srcline189">189</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,190" id="srcline190">190</a></span><span class="line">            <span class="mxinfo" id="T47:U2268"><span class="var type1" id="S40T47U2606">au_prime</span> = <span class="mxinfo" id="T47:U2270"><span class="mxinfo" id="T47:U2271"><span class="mxinfo" id="T47:U2272"><span class="mxinfo" id="T1:U2273"><span class="var type1" id="S22T5U2611">K</span>(<span class="mxinfo" id="T1:U2275">1</span>,<span class="mxinfo" id="T1:U2276">1</span>)</span>*<span class="var type1" id="S37T47U2614">dB1_x</span></span> + <span class="mxinfo" id="T47:U2278"><span class="mxinfo" id="T1:U2279"><span class="var type1" id="S22T5U2617">K</span>(<span class="mxinfo" id="T1:U2281">1</span>,<span class="mxinfo" id="T1:U2282">2</span>)</span>*<span class="var type1" id="S38T47U2620">dB2_x</span></span></span> + <span class="mxinfo" id="T47:U2284"><span class="mxinfo" id="T1:U2285"><span class="var type1" id="S22T5U2623">K</span>(<span class="mxinfo" id="T1:U2287">1</span>,<span class="mxinfo" id="T1:U2288">3</span>)</span>*<span class="var type1" id="S39T47U2626">dB3_x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,191" id="srcline191">191</a></span><span class="line">            <span class="mxinfo" id="T47:U2290"><span class="var type1" id="S41T47U2629">av_prime</span> = <span class="mxinfo" id="T47:U2292"><span class="mxinfo" id="T47:U2293"><span class="mxinfo" id="T47:U2294"><span class="mxinfo" id="T1:U2295"><span class="var type1" id="S22T5U2634">K</span>(<span class="mxinfo" id="T1:U2297">2</span>,<span class="mxinfo" id="T1:U2298">1</span>)</span>*<span class="var type1" id="S37T47U2637">dB1_x</span></span> + <span class="mxinfo" id="T47:U2300"><span class="mxinfo" id="T1:U2301"><span class="var type1" id="S22T5U2640">K</span>(<span class="mxinfo" id="T1:U2303">2</span>,<span class="mxinfo" id="T1:U2304">2</span>)</span>*<span class="var type1" id="S38T47U2643">dB2_x</span></span></span> + <span class="mxinfo" id="T47:U2306"><span class="mxinfo" id="T1:U2307"><span class="var type1" id="S22T5U2646">K</span>(<span class="mxinfo" id="T1:U2309">2</span>,<span class="mxinfo" id="T1:U2310">3</span>)</span>*<span class="var type1" id="S39T47U2649">dB3_x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,192" id="srcline192">192</a></span><span class="line">            <span class="mxinfo" id="T47:U2312"><span class="var type1" id="S42T47U2652">b_prime</span> = <span class="mxinfo" id="T47:U2314"><span class="mxinfo" id="T47:U2315"><span class="mxinfo" id="T47:U2316"><span class="mxinfo" id="T1:U2317"><span class="var type1" id="S22T5U2657">K</span>(<span class="mxinfo" id="T1:U2319">3</span>,<span class="mxinfo" id="T1:U2320">1</span>)</span>*<span class="var type1" id="S37T47U2660">dB1_x</span></span> + <span class="mxinfo" id="T47:U2322"><span class="mxinfo" id="T1:U2323"><span class="var type1" id="S22T5U2663">K</span>(<span class="mxinfo" id="T1:U2325">3</span>,<span class="mxinfo" id="T1:U2326">2</span>)</span>*<span class="var type1" id="S38T47U2666">dB2_x</span></span></span> + <span class="mxinfo" id="T47:U2328"><span class="mxinfo" id="T1:U2329"><span class="var type1" id="S22T5U2669">K</span>(<span class="mxinfo" id="T1:U2331">3</span>,<span class="mxinfo" id="T1:U2332">3</span>)</span>*<span class="var type1" id="S39T47U2672">dB3_x</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,193" id="srcline193">193</a></span><span class="line">            <span class="mxinfo" id="T47:U2334"><span class="var type1" id="S43T47U2675">bu_prime</span> = <span class="var type1" id="S42T47U2676">b_prime</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,194" id="srcline194">194</a></span><span class="line">            <span class="mxinfo" id="T47:U2337"><span class="var type1" id="S44T47U2679">bv_prime</span> = <span class="var type1" id="S42T47U2680">b_prime</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,195" id="srcline195">195</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,196" id="srcline196">196</a></span><span class="line">            <span class="mxinfo" id="T1:U2340"><span class="var type1" id="S45T1U2683">b_sq</span> = <span class="mxinfo" id="T1:U2342"><span class="var type1" id="S29T1U2685">b</span>^2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,197" id="srcline197">197</a></span><span class="line">            <span class="mxinfo" id="T47:U2344"><span class="var type1" id="S46T47U2689">du_dx</span> = <span class="mxinfo" id="T47:U2346">(<span class="mxinfo" id="T47:U2347"><span class="mxinfo" id="T47:U2348"><span class="var type1" id="S40T47U2694">au_prime</span>*<span class="var type1" id="S30T1U2695">bu</span></span> - <span class="mxinfo" id="T47:U2351"><span class="var type1" id="S32T1U2697">au</span>*<span class="var type1" id="S43T47U2698">bu_prime</span></span></span>)/<span class="var type1" id="S45T1U2699">b_sq</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,198" id="srcline198">198</a></span><span class="line">            <span class="mxinfo" id="T47:U2355"><span class="var type1" id="S47T47U2702">dv_dx</span> = <span class="mxinfo" id="T47:U2357">(<span class="mxinfo" id="T47:U2358"><span class="mxinfo" id="T47:U2359"><span class="var type1" id="S41T47U2707">av_prime</span>*<span class="var type1" id="S31T1U2708">bv</span></span> - <span class="mxinfo" id="T47:U2362"><span class="var type1" id="S33T1U2710">av</span>*<span class="var type1" id="S44T47U2711">bv_prime</span></span></span>)/<span class="var type1" id="S45T1U2712">b_sq</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,199" id="srcline199">199</a></span><span class="line">            <span class="mxinfo" id="T64:U2366"><span class="mxinfo" id="T64:U2367"><span class="var type1" id="S9T48U2716">A_lin</span>(<span class="mxinfo" id="T16:U2369"><span class="var type1" id="S16T1U2718">k</span>:<span class="mxinfo" id="T1:U2371"><span class="var type1" id="S16T1U2720">k</span>+1</span></span>,:)</span> = <span class="mxinfo" id="T64:U2373">[<span class="var type1" id="S46T47U2725">du_dx</span>;<span class="var type1" id="S47T47U2727">dv_dx</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,200" id="srcline200">200</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="77,201" id="srcline201">201</a></span><span class="line">            <span class="mxinfo" id="T1:U2376"><span class="mxinfo" id="T1:U2377"><span class="var type1" id="S13T34U2731">z_meas</span>(<span class="var type1" id="S16T1U2732">k</span>,<span class="mxinfo" id="T1:U2380">1</span>)</span> = <span class="mxinfo" id="T1:U2381"><span class="mxinfo" id="T3:U2382"><span class="mxinfo" id="T53:U2383"><span class="var type1" id="S5T2U2737">z</span>(<span class="mxinfo" id="T1:U2385">1</span>,<span class="var type1" id="S8T1U2739">i</span>)</span>.blue_data</span>(<span class="mxinfo" id="T1:U2387">1</span>,<span class="mxinfo" id="T1:U2388">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,202" id="srcline202">202</a></span><span class="line">            <span class="mxinfo" id="T1:U2389"><span class="mxinfo" id="T1:U2390"><span class="var type1" id="S13T34U2746">z_meas</span>(<span class="mxinfo" id="T1:U2392"><span class="var type1" id="S16T1U2748">k</span>+<span class="mxinfo" id="T1:U2394">1</span></span>,<span class="mxinfo" id="T1:U2395">1</span>)</span> = <span class="mxinfo" id="T1:U2396"><span class="mxinfo" id="T3:U2397"><span class="mxinfo" id="T53:U2398"><span class="var type1" id="S5T2U2754">z</span>(<span class="mxinfo" id="T1:U2400">1</span>,<span class="var type1" id="S8T1U2756">i</span>)</span>.blue_data</span>(<span class="mxinfo" id="T1:U2402">1</span>,<span class="mxinfo" id="T1:U2403">2</span>)</span></span>;                        </span></span>
<span class="srcline"><span class="lineno"><a href="77,203" id="srcline203">203</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="77,204" id="srcline204">204</a></span><span class="line">            <span class="mxinfo" id="T1:U2404"><span class="var type1" id="S16T1U2762">k</span> = <span class="mxinfo" id="T1:U2406"><span class="var type1" id="S16T1U2764">k</span> + <span class="mxinfo" id="T1:U2408">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,205" id="srcline205">205</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,206" id="srcline206">206</a></span><span class="line">    <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="77,207" id="srcline207">207</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="77,208" id="srcline208">208</a></span><span class="line">    <span class="mxinfo" id="T34:U2409"><span class="var type1" id="S11T34U2768">b_lin</span> = <span class="mxinfo" id="T34:U2411"><span class="var type1" id="S13T34U2770">z_meas</span> - <span class="var type1" id="S12T34U2771">z_est</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,209" id="srcline209">209</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="77,210" id="srcline210">210</a></span><span class="line">    <span class="mxinfo" id="T46:U2414">[<span class="var type1" id="S48T46U2775">delta_x</span>,<span class="var type1" id="S49T1U2776">norm_err</span>,<span class="var type1" id="S50T46U2777">delta_x_plus_x</span>] = <span class="fcn" id="F518N14:B2779">solveLSQ</span>(<span class="var type1" id="S9T48U2780">A_lin</span>,<span class="var type1" id="S11T34U2781">b_lin</span>,<span class="var type1" id="S4T46U2782">x</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,211" id="srcline211">211</a></span><span class="line">    <span class="mxinfo" id="T46:U2421"><span class="var type1" id="S2T46U2785">x_est</span> = <span class="var type1" id="S50T46U2786">delta_x_plus_x</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,212" id="srcline212">212</a></span><span class="line">    <span class="mxinfo" id="T1:U2424"><span class="var type1" id="S3T1U2789">resnorm</span> = <span class="var type1" id="S49T1U2790">norm_err</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,213" id="srcline213">213</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,214" id="srcline214">214</a></span><span class="line"></span></span>
</pre>
