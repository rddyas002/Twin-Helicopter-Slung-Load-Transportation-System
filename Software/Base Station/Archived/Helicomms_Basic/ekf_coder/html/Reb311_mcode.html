<pre class="code">
<span class="srcline"><span class="lineno"><a href="71,154" id="srcline154">154</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="71,155" id="srcline155">155</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="71,156" id="srcline156">156</a></span><span class="line"><span class="comment">% this function rotates the vector x from the body into the earth using the</span></span></span>
<span class="srcline"><span class="lineno"><a href="71,157" id="srcline157">157</a></span><span class="line"><span class="comment">% quaternion from the standard quaternion time derivative equation</span></span></span>
<span class="srcline"><span class="lineno"><a href="71,158" id="srcline158">158</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S82T6U1180">y</span>] = Reb(<span class="var type1" id="S83T9U1183">q</span>,<span class="var type1" id="S84T6U1184">x</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="71,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo" id="T1:U4"><span class="var type1" id="S85T1U1187">q1</span> = <span class="mxinfo" id="T1:U6"><span class="var type1" id="S83T9U1189">q</span>(<span class="mxinfo" id="T1:U8">1</span>)</span></span>; <span class="mxinfo" id="T1:U9"><span class="var type1" id="S86T1U1193">q2</span> = <span class="mxinfo" id="T1:U11"><span class="var type1" id="S83T9U1195">q</span>(<span class="mxinfo" id="T1:U13">2</span>)</span></span>; <span class="mxinfo" id="T1:U14"><span class="var type1" id="S87T1U1199">q3</span> = <span class="mxinfo" id="T1:U16"><span class="var type1" id="S83T9U1201">q</span>(<span class="mxinfo" id="T1:U18">3</span>)</span></span>; <span class="mxinfo" id="T1:U19"><span class="var type1" id="S88T1U1205">q4</span> = <span class="mxinfo" id="T1:U21"><span class="var type1" id="S83T9U1207">q</span>(<span class="mxinfo" id="T1:U23">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,160" id="srcline160">160</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="71,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo" id="T1:U24"><span class="var type1" id="S89T1U1211">rq11</span> = <span class="mxinfo" id="T1:U26"><span class="mxinfo" id="T1:U27"><span class="mxinfo" id="T1:U28"><span class="mxinfo" id="T1:U29"><span class="var type1" id="S85T1U1216">q1</span>^2</span> + <span class="mxinfo" id="T1:U31"><span class="var type1" id="S86T1U1219">q2</span>^2</span></span> - <span class="mxinfo" id="T1:U33"><span class="var type1" id="S87T1U1222">q3</span>^2</span></span> - <span class="mxinfo" id="T1:U35"><span class="var type1" id="S88T1U1225">q4</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo" id="T1:U37"><span class="var type1" id="S90T1U1229">rq12</span> = <span class="mxinfo" id="T1:U39"><span class="mxinfo" id="T1:U40">2</span>*(<span class="mxinfo" id="T1:U41"><span class="mxinfo" id="T1:U42"><span class="var type1" id="S86T1U1235">q2</span>*<span class="var type1" id="S87T1U1236">q3</span></span> - <span class="mxinfo" id="T1:U45"><span class="var type1" id="S85T1U1238">q1</span>*<span class="var type1" id="S88T1U1239">q4</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,163" id="srcline163">163</a></span><span class="line"><span class="mxinfo" id="T1:U48"><span class="var type1" id="S91T1U1242">rq13</span> = <span class="mxinfo" id="T1:U50"><span class="mxinfo" id="T1:U51">2</span>*(<span class="mxinfo" id="T1:U52"><span class="mxinfo" id="T1:U53"><span class="var type1" id="S86T1U1248">q2</span>*<span class="var type1" id="S88T1U1249">q4</span></span> + <span class="mxinfo" id="T1:U56"><span class="var type1" id="S85T1U1251">q1</span>*<span class="var type1" id="S87T1U1252">q3</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,164" id="srcline164">164</a></span><span class="line"><span class="mxinfo" id="T1:U59"><span class="var type1" id="S92T1U1255">rq21</span> = <span class="mxinfo" id="T1:U61"><span class="mxinfo" id="T1:U62">2</span>*(<span class="mxinfo" id="T1:U63"><span class="mxinfo" id="T1:U64"><span class="var type1" id="S86T1U1261">q2</span>*<span class="var type1" id="S87T1U1262">q3</span></span> + <span class="mxinfo" id="T1:U67"><span class="var type1" id="S85T1U1264">q1</span>*<span class="var type1" id="S88T1U1265">q4</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,165" id="srcline165">165</a></span><span class="line"><span class="mxinfo" id="T1:U70"><span class="var type1" id="S93T1U1268">rq22</span> = <span class="mxinfo" id="T1:U72"><span class="mxinfo" id="T1:U73"><span class="mxinfo" id="T1:U74"><span class="mxinfo" id="T1:U75"><span class="var type1" id="S85T1U1273">q1</span>^2</span> - <span class="mxinfo" id="T1:U77"><span class="var type1" id="S86T1U1276">q2</span>^2</span></span> + <span class="mxinfo" id="T1:U79"><span class="var type1" id="S87T1U1279">q3</span>^2</span></span> - <span class="mxinfo" id="T1:U81"><span class="var type1" id="S88T1U1282">q4</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,166" id="srcline166">166</a></span><span class="line"><span class="mxinfo" id="T1:U83"><span class="var type1" id="S94T1U1286">rq23</span> = <span class="mxinfo" id="T1:U85"><span class="mxinfo" id="T1:U86">2</span>*(<span class="mxinfo" id="T1:U87"><span class="mxinfo" id="T1:U88"><span class="var type1" id="S87T1U1292">q3</span>*<span class="var type1" id="S88T1U1293">q4</span></span> - <span class="mxinfo" id="T1:U91"><span class="var type1" id="S85T1U1295">q1</span>*<span class="var type1" id="S86T1U1296">q2</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,167" id="srcline167">167</a></span><span class="line"><span class="mxinfo" id="T1:U94"><span class="var type1" id="S95T1U1299">rq31</span> = <span class="mxinfo" id="T1:U96"><span class="mxinfo" id="T1:U97">2</span>*(<span class="mxinfo" id="T1:U98"><span class="mxinfo" id="T1:U99"><span class="var type1" id="S86T1U1305">q2</span>*<span class="var type1" id="S88T1U1306">q4</span></span> - <span class="mxinfo" id="T1:U102"><span class="var type1" id="S85T1U1308">q1</span>*<span class="var type1" id="S87T1U1309">q3</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,168" id="srcline168">168</a></span><span class="line"><span class="mxinfo" id="T1:U105"><span class="var type1" id="S96T1U1312">rq32</span> = <span class="mxinfo" id="T1:U107"><span class="mxinfo" id="T1:U108">2</span>*(<span class="mxinfo" id="T1:U109"><span class="mxinfo" id="T1:U110"><span class="var type1" id="S87T1U1318">q3</span>*<span class="var type1" id="S88T1U1319">q4</span></span> + <span class="mxinfo" id="T1:U113"><span class="var type1" id="S85T1U1321">q1</span>*<span class="var type1" id="S86T1U1322">q2</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,169" id="srcline169">169</a></span><span class="line"><span class="mxinfo" id="T1:U116"><span class="var type1" id="S97T1U1325">rq33</span> = <span class="mxinfo" id="T1:U118"><span class="mxinfo" id="T1:U119"><span class="mxinfo" id="T1:U120"><span class="mxinfo" id="T1:U121"><span class="var type1" id="S85T1U1330">q1</span>^2</span> - <span class="mxinfo" id="T1:U123"><span class="var type1" id="S86T1U1333">q2</span>^2</span></span> - <span class="mxinfo" id="T1:U125"><span class="var type1" id="S87T1U1336">q3</span>^2</span></span> + <span class="mxinfo" id="T1:U127"><span class="var type1" id="S88T1U1339">q4</span>^2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,170" id="srcline170">170</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="71,171" id="srcline171">171</a></span><span class="line"><span class="mxinfo" id="T5:U129"><span class="var type1" id="S98T5U1343">Rq</span> = <span class="mxinfo" id="T5:U131">[<span class="mxinfo" id="T17:U132"><span class="var type1" id="S89T1U1346">rq11</span> <span class="var type1" id="S90T1U1347">rq12</span> <span class="var type1" id="S91T1U1348">rq13</span></span>; <span class="mxinfo" id="T17:U136"><span class="var type1" id="S92T1U1350">rq21</span> <span class="var type1" id="S93T1U1351">rq22</span> <span class="var type1" id="S94T1U1352">rq23</span></span>; <span class="mxinfo" id="T17:U140"><span class="var type1" id="S95T1U1354">rq31</span> <span class="var type1" id="S96T1U1355">rq32</span> <span class="var type1" id="S97T1U1356">rq33</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,172" id="srcline172">172</a></span><span class="line"><span class="mxinfo" id="T6:U144"><span class="var type1" id="S82T6U1359">y</span> = <span class="mxinfo" id="T6:U146"><span class="var type1" id="S98T5U1361">Rq</span>*<span class="var type1" id="S84T6U1362">x</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="71,173" id="srcline173">173</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
